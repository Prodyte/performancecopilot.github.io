---
- name: Wekan Backup
  hosts: osas
  tasks:
    - name: Make dump directory
      shell: 'docker exec -d wekan-db sh -c "mkdir -p /tmp/wekandb.bak/"'

    - name: Dump mongodb
      shell: 'docker exec -d wekan-db sh -c "mongodump --db wekan --out /tmp/wekandb.bak"'

    - name: Copy wekan out of container
      shell: "docker cp wekan-db:/tmp/wekandb.bak wekan"
      args:
        chdir: /home/wekan/
