<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='initial-scale=1' name='viewport'>
<title>Performance Co-Pilot</title>
<link href='/assets/css/screen.css' media='all' rel='stylesheet' type='text/css'>
<link href='/assets/css/master.css' media='all' rel='stylesheet' type='text/css'>
<link href='/images/pcp.ico' rel='shortcut icon' type='image/ico'>

</head>
<body>
<header class='global-header'>
<div class='row'>
<h1 class='global-logo colspan12-6 colspan8-4 colspan6-3 colspan2-1 as-grid'>
<a href='/index.html'>Performance Co-Pilot</a>
</h1>
<nav class='global-header__navigation colspan12-6 colspan8-6 colspan6-4 colspan2-1 as-grid'>
<ul>
<li>
<a href='/features.html'>Features</a>
</li>
<li>
<a href='/documentation.html'>Documentation</a>
</li>
<li>
<a href='/download.html'>Download</a>
</li>
<li>
<a href='/community.html'>Get Involved</a>
</li>
</ul>
</nav>
</div>
</header>

<div class='site-content'>
<div class='how-to is-typeset'>
<div class='row-parent'>
<div class='row'>
<div class='manpage'>
ï»¿
 <h1>
  PMWEBD
 </h1>
 Section: User Commands  (1)
 <br/>
 <a href="#index">
  Index
 </a>
 <a href="/man">
  Return to Main Contents
 </a>
 <hr/>
 <a name="lbAB">
 </a>
 <h2>
  NAME
 </h2>
 <b>
  pmwebd
 </b>
 - web access to PCP
 <p>
 </p>
 <p>
  <a name="lbAC">
  </a>
 </p>
 <h2>
  SYNOPSIS
 </h2>
 <b>
  pmwebd
 </b>
 [
 <b>
  -p
 </b>
 <i>
  port
 </i>
 ]
[
 <b>
  -4
 </b>
 ]
[
 <b>
  -6
 </b>
 ]
[
 <b>
  -t
 </b>
 <i>
  timeout
 </i>
 ]
[
 <b>
  -R
 </b>
 <i>
  resdir
 </i>
 ]
[
 <b>
  -c
 </b>
 <i>
  number
 </i>
 ]
[
 <b>
  -h
 </b>
 <i>
  hostname
 </i>
 ]
[
 <b>
  -a
 </b>
 <i>
  archive
 </i>
 ]
[
 <b>
  -C
 </b>
 ]
[
 <b>
  -P
 </b>
 ]
[
 <b>
  -L
 </b>
 ]
[
 <b>
  -N
 </b>
 ]
[
 <b>
  -G
 </b>
 ]
[
 <b>
  -X
 </b>
 ]
[
 <b>
  -i
 </b>
 <i>
  min-interval
 </i>
 ]
[
 <b>
  -J
 </b>
 [
 <b>
  -K
 </b>
 <i>
  spec
 </i>
 ]
[
 <b>
  -A
 </b>
 <i>
  archivesdir
 </i>
 ]
[
 <b>
  -S
 </b>
 ]
[
 <b>
  -l
 </b>
 <i>
  logfile
 </i>
 ]
[
 <b>
  -U
 </b>
 <i>
  username
 </i>
 ]
[
 <b>
  -v
 </b>
 ]
[
 <b>
  -?
 </b>
 ]
 <a name="lbAD">
 </a>
 <h2>
  DESCRIPTION
 </h2>
 <b>
  pmwebd
 </b>
 is a network daemon that binds a subset of the
Performance Co-Pilot (PCP) client API (
 <b>
  <a href="/man/man3/pmapi.3.html">
   PMAPI
  </a>
 </b>
 (3))

to RESTful web
applications using a subset the PCP REST API (
 <b>
  <a href="/man/man3/pmwebapi.3.html">
   PMWEBAPI
  </a>
 </b>
 (3))
 <b>
  as
 </b>
 described
 <b>
  below.
 </b>
 <p>
  Web clients request a URI with the prefix
  <b>
   /pmapi
  </b>
  to access the bindings.
  <b>
   pmwebd
  </b>
  creates PCP contexts as requested
by a dynamic pool of remote clients, and maintains them as long as the
clients regularly reconnect to request PMAPI operations.  Otherwise,
PCP contexts are closed after a timeout.  Permanent contexts may be
requested on the command line.
 </p>
 <p>
  In addition to the API binding,
  <b>
   pmwebd
  </b>
  may be optionally configured as a
simple HTTP file server, in order to feed the web application itself
to a web browser.  URIs not matching the
  <b>
   /pmapi
  </b>
  prefix are mapped to files under the configured resource directory, if
the
  <b>
   -R
  </b>
  option was given.
 </p>
 <p>
  In addition,
  <b>
   pmwebd
  </b>
  may be optionally configured as a server of a subset
of the graphite 0.9.12 web API, for URLs with the
  <b>
   /graphite
  </b>
  prefix, in order to expose PCP archives to interactive data-graphing web
applications.
 </p>
 <p>
  The options to
  <b>
   pmwebd
  </b>
  are as follows.
 </p>
 <dl compact="">
  <dt>
   <b>
    -p
   </b>
   <i>
    port
   </i>
  </dt>
  <dd>
   Set the TCP port number on which
   <b>
    pmwebd
   </b>
   will listen for HTTP requests.
The default is 44323.
  </dd>
  <dt>
   <b>
    -4
   </b>
   or
   <b>
    -6
   </b>
  </dt>
  <dd>
   Listen only on IPv4 or IPv6.  By default,
   <b>
    pmwebd
   </b>
   will listen on both
protocols, if possible.
  </dd>
  <dt>
   <b>
    -A
   </b>
   <i>
    archdir
   </i>
  </dt>
  <dd>
   Limit remote access to archives to only those beneath the given directory.
For performance, symbolic links to other directories may not
be followed.
By default, only files beneath the initial
   <b>
    pmwebd
   </b>
   working directory may
be accessed.
  </dd>
  <dt>
   <b>
    -R
   </b>
   <i>
    resdir
   </i>
  </dt>
  <dd>
   Activate file serving beneath the given resource directory.  All regular
files there may be read and transcribed to remote clients.  By default,
file serving is disabled.
  </dd>
  <dt>
   <b>
    -G
   </b>
  </dt>
  <dd>
   Activate servicing of a subset of the graphite webapi.  This exposes all
PCP archives under the
   <b>
    -A
   </b>
   directory to remote clients.  By default,
graphite webapi serving is disabled.  To use the graphite and/or grafana
web applications included with
   <b>
    pmwebd
   </b>
   ,

use both
   <b>
    -G
   </b>
   and
   <b>
    -R
   </b>
   , and connect your web browser to
   <b>
    <a href="http://127.0.0.1:43323/">
     http://127.0.0.1:43323/
    </a>
   </b>
  </dd>
  <dt>
   <b>
    -X
   </b>
  </dt>
  <dd>
   Disable encoding of common characters for metric names, which allows
shorter graphite metric names.
  </dd>
  <dt>
   <b>
    -i
   </b>
   <i>
    min-interval
   </i>
  </dt>
  <dd>
   Set the minimum sampling interval for graphite time series in seconds.
The default is 60.  Smaller values give higher precision (but not
necessarily accuracy) data, but may cost extra processing time at
   <b>
    pmwebd
   </b>
   or the web browser; and vice versa.
  </dd>
  <dt>
   <b>
    -J
   </b>
  </dt>
  <dd>
   When constructing graphite metric names, use the stored
   <i>
    hostname
   </i>
   instead of a archive pathname as the first component.  This virtually
unifies
   <i>
    all
   </i>
   archives found with the same hostname into a single
time series.  The host name is canonicalized: any symbol
characters other than _ (underscore), space, - (hyphen), and / (slash)
are replaced by _ (underscore).
  </dd>
  <dt>
   <b>
    -t
   </b>
   <i>
    timeout
   </i>
  </dt>
  <dd>
   Set the maximum timeout (in seconds) after the last operation on a pmapi web
context, before it is closed by
   <b>
    pmwebd
   </b>
   .

A smaller timeout may be requested
by the web client. The default is 300.
  </dd>
  <dt>
   <b>
    -c
   </b>
   <i>
    number
   </i>
  </dt>
  <dd>
   Reset the next PMWEBAPI permanent context identifier as given.
The default is 1.
  </dd>
  <dt>
   <b>
    -h
   </b>
   <i>
    hostname
   </i>
   or
   <b>
    -a
   </b>
   <i>
    archive
   </i>
   or
   <b>
    -L
   </b>
  </dt>
  <dd>
   Assign the next permanent PMWEBAPI context identifier to a PMAPI connection
to the given host (with an extended syntax as given in
   <b>
    <a href="/man/man1/pcpintro.1.html">
     PCPIntro
    </a>
   </b>
   (1)),

or archive file, or the PM_CONTEXT_LOCAL.
  </dd>
  <dt>
   <b>
    -C
   </b>
  </dt>
  <dd>
   Mandatory authentication mode, where all host specifications at context
creation time must be accompanied by credentials (username and password).
These are then passed to
   <b>
    <a href="/man/man1/pmcd.1.html">
     pmcd
    </a>
   </b>
   (1)

when creating the context.
In addition, subsequent PMAPI context operations require matching
HTTP Basic authentication credentials.
This setting is incompatible with the permissive mode of operation.
  </dd>
  <dt>
   <b>
    -P
   </b>
  </dt>
  <dd>
   Run in permissive mode, allowing Unix domain socket connections and/or
local PMDA contexts.
By default these are not allowed due to the automatic authentication that
is performed on the server in these modes.
Only enable this option if you understand the risks involved, and are sure
that all remote
   <b>
    pmwebd
   </b>
   accesses will be from benevolent users.
If enabled, unauthenticated remote
   <b>
    <a href="/man/man3/pmwebapi.3.html">
     PMWEBAPI
    </a>
   </b>
   (3)

clients will be able to access
potentially sensitive performance metric values which an unauthenticated
   <b>
    <a href="/man/man3/pmapi.3.html">
     PMAPI
    </a>
   </b>
   (3)

client usually would not be able to.
Refer to CVE-2012-3419 for additional details.
  </dd>
  <dt>
   <b>
    -N
   </b>
  </dt>
  <dd>
   Disable creation of new PMWEBAPI contexts via HTTP requests, leaving only
permanent ones accessible.
  </dd>
  <dt>
   <b>
    -K
   </b>
   <i>
    spec
   </i>
  </dt>
  <dd>
   When
fetching metrics from a local context, the
   <b>
    -K
   </b>
   option may be used to control the DSO PMDAs that should be
made accessible.  The
   <i>
    spec
   </i>
   argument conforms to the syntax described in
   <b>
    <a href="/man/man3/pmspeclocalpmda.3.html">
     pmSpecLocalPMDA
    </a>
   </b>
   (3).

More than one
   <b>
    -K
   </b>
   option may be used.
  </dd>
  <dt>
   <b>
    -l
   </b>
   <i>
    logfile
   </i>
  </dt>
  <dd>
   By default, logging goes to standard output/error file handles.
The verbosity flag
   <b>
    -v
   </b>
   affects the amount of traffic.  The
   <b>
    -l
   </b>
   option causes the log file to be written to
   <i>
    logfile
   </i>
   instead.
If the log file cannot be created or is not writable, output is
written to the standard error instead.
  </dd>
  <dt>
   <b>
    -U
   </b>
   <i>
    username
   </i>
  </dt>
  <dd>
   If invoked as root, assume the identity of
   <i>
    username
   </i>
   before starting to accept incoming requests from web clients.
  </dd>
  <dt>
   <b>
    -S
   </b>
  </dt>
  <dd>
   Disable service advertisement.
By default,
   <b>
    pmwebd
   </b>
   will advertise its presence on the network using any available
mechanisms (such as Avahi/DNS-SD), assisting remote monitoring
tools with finding it.
These mechanisms are disabled with this option.
  </dd>
  <dt>
   <b>
    -v
   </b>
  </dt>
  <dd>
   Increase the verbosity of
   <b>
    pmwebd
   </b>
   as it logs to its standard output/error.
  </dd>
  <dt>
   <b>
    -?
   </b>
  </dt>
  <dd>
   Show
   <b>
    pmwebd
   </b>
   invocation help and exit.
   <p>
   </p>
  </dd>
 </dl>
 <a name="lbAE">
 </a>
 <h2>
  CONTEXT CREATION: pmNewContext
 </h2>
 <p>
  To create a new web context identifier, a web client invokes:
 </p>
 <dl compact="">
  <dt>
   <b>
    /pmapi/context?hostname=STRING
   </b>
  </dt>
  <dd>
  </dd>
  <dt>
   <b>
    /pmapi/context?hostspec=STRING
   </b>
  </dt>
  <dd>
   Creates a PM_CONTEXT_HOST PMAPI context with the given host name and/or extended
specification.  If the host specification contains a userid/password combination,
then the corresponding PMAPI context operations will require HTTP Basic authentication
credentials with matching userid/password.
  </dd>
 </dl>
 <p>
  In addition, the web client may add the parameter
  <b>
   &amp;polltimeout=MMMM
  </b>
  for a maximum interval (in seconds) between expected accesses to the
given context.  This value is limited by pmwebd configuration, and is
a courtesy to allow pmwebd to free up memory earlier in case of sudden
web application shutdown.
 </p>
 <p>
  If successful, the response from these requests is a JSON document of the form:
 </p>
 <p>
  <br/>
 </p>
 <dl compact="">
  <dt>
  </dt>
  <dd>
   <pre>
{ "context" : NNNNN }

</pre>
  </dd>
 </dl>
 <p>
  The number (a 32-bit unsigned decimal) is then used in all later
operations.
 </p>
 <p>
  <a name="lbAF">
  </a>
 </p>
 <h2>
  CONTEXT CREATION: configurable permanent contexts
 </h2>
 <p>
  In addition, permanent contexts may be created by pmwebd at
initialization using its -h, -a, -L command line options, so that a
set of fixed NNNNN numbers may be made available to web clients.
 </p>
 <p>
  <a name="lbAG">
  </a>
 </p>
 <h2>
  PMAPI OPERATIONS
 </h2>
 <p>
  The general form of the requests is as follows:
  <b>
   /pmapi/NNNNN/OPERATION
  </b>
  where
 </p>
 <dl compact="">
  <dt>
   <b>
    /pmapi
   </b>
  </dt>
  <dd>
   is the fixed prefix for all PMWEBAPI operations,
  </dd>
  <dt>
   <b>
    NNNNN
   </b>
  </dt>
  <dd>
   is a PMWEBAPI context number returned from a context-creation call, or
assigned permanently at pmwebd startup, and
  </dd>
  <dt>
   <b>
    OPERATION?PARAM1=VALUE2&amp;PARAM2=VALUE2
   </b>
  </dt>
  <dd>
   identifies the operation and its URL-encoded parameters.  Some
parameters may be optional.
   <p>
   </p>
  </dd>
 </dl>
 <a name="lbAH">
 </a>
 <h3>
  METRIC METADATA: pmLookupName, pmLookupDesc, pmLookupText, pmTraversePMNS_r
 </h3>
 <p>
  The general form of the requests is as follows:
 </p>
 <dl compact="">
  <dt>
   <b>
    /pmapi/NNNNN/_metric
   </b>
  </dt>
  <dd>
   Traverse the entire Performance Metrics Name Space (PMNS).
  </dd>
  <dt>
   <b>
    /pmapi/NNNNN/_metric?prefix=NAME
   </b>
  </dt>
  <dd>
   Traverse the subtree of PMNS with the prefix NAME.
  </dd>
 </dl>
 <p>
  The response is a JSON document that provides the metric metadata
as an array.  For example:
 </p>
 <p>
  <br/>
 </p>
 <dl compact="">
  <dt>
  </dt>
  <dd>
   <pre>
{ "metrics": [ 
    { "name":"foo.bar", "pmID":PPPP, "indom":DDDD,
      "type":"32", "sem":"instant", "units":"MHz",
      "text-oneline":"foo bar", "text-help":"blah blah blah" },
    { "name":"foo.bar2", ... }
    ...
  ] }

</pre>
  </dd>
 </dl>
 <p>
  Most of the fields are self-explanatory.
 </p>
 <dl compact="">
  <dt>
   name
  </dt>
  <dd>
   A name for the metric as defined in the PMNS.
If the PMNS contains multiple names associated with the metric's
Performance Metric Identifier (PMID),
one of these will be returned via name, but there is no way to
determine which of the duplicate names this will be.
  </dd>
  <dt>
   PPPP
  </dt>
  <dd>
   the PMID
  </dd>
  <dt>
   DDDD
  </dt>
  <dd>
   the instance domain
  </dd>
  <dt>
   type
  </dt>
  <dd>
   from pmTypeStr
  </dd>
  <dt>
   units
  </dt>
  <dd>
   from pmUnitsStr
  </dd>
  <dt>
   sem
  </dt>
  <dd>
   an abbreviation of the metric semantic:
   <table>
    <tr valign="top">
     <td>
      PM_SEM_COUNTER  "counter"
     </td>
     <td>
      <br/>
     </td>
    </tr>
    <tr valign="top">
     <td>
      PM_SEM_INSTANT  "instant"
     </td>
     <td>
      <br/>
     </td>
    </tr>
    <tr valign="top">
     <td>
      PM_SEM_DISCRETE "discrete"
     </td>
     <td>
      <br/>
     </td>
    </tr>
   </table>
   <p>
   </p>
  </dd>
 </dl>
 <a name="lbAI">
 </a>
 <h3>
  METRIC VALUE: pmFetch
 </h3>
 <p>
  The general form of the requests is as follows:
 </p>
 <dl compact="">
  <dt>
   <b>
    /pmapi/NNNNN/_fetch?names=NAME1,NAME2
   </b>
  </dt>
  <dd>
   Fetch current values for given named metrics.
  </dd>
  <dt>
   <b>
    /pmapi/NNNNN/_fetch?pmids=PPPP1,PPPP2
   </b>
  </dt>
  <dd>
   Fetch current values for given PMIDs.
  </dd>
 </dl>
 <p>
  If any of the names/pmids are valid, the response is a JSON document that
provides the values for all requested metrics, for all their instances.
 </p>
 <p>
  <br/>
 </p>
 <dl compact="">
  <dt>
  </dt>
  <dd>
   <pre>
{ "timestamp": { "s":SEC, "us":USEC },
  "values": [
        { "pmid":PPPP1, "name":"NAME1",
          "instances:" [
               { "instance":IIII1, "value":VALUE1 }
               { "instance":IIII2, "value":VALUE2 }
               ...
          ] },
        { "pmid":PPPP2, "name":"NAME2", ... }
        ...
  ] }

</pre>
  </dd>
 </dl>
 <p>
  Most of the fields are self-explanatory.  Numeric metric types
are represented as JSON integer or floating-point values.  Strings
are passed verbatim, except that non-ASCII values are replaced
with a Unicode 0xFFFD REPLACEMENT CHARACTER code.  Event type metrics
are not currently supported.
 </p>
 <p>
  <a name="lbAJ">
  </a>
 </p>
 <h3>
  INSTANCE DOMAINS METADATA: pmGetInDom, pmNameInDom, pmLookupInDom
 </h3>
 <p>
  The general form of the requests is as follows:
 </p>
 <dl compact="">
  <dt>
   <b>
    /pmapi/NNNN/_indom?indom=DDDD
   </b>
  </dt>
  <dd>
   List instances of the given instance domain.
  </dd>
  <dt>
   <b>
    /pmapi/NNNN/_indom?name=NAME
   </b>
  </dt>
  <dd>
   List instances of the instance domain belonging to the named metric.
  </dd>
 </dl>
 <p>
  In addition, either query may be suffixed with:
 </p>
 <dl compact="">
  <dt>
   <b>
    &amp;instance=IIII,JJJJ
   </b>
  </dt>
  <dd>
   Restrict listings to given instance code numbers.
  </dd>
  <dt>
   <b>
    &amp;iname=INAME1,INAME2
   </b>
  </dt>
  <dd>
   Restrict listings to given instance names.
  </dd>
 </dl>
 <p>
 </p>
 <p>
  The response is a JSON document that provides the metric metadata
as an array.  For example:
 </p>
 <p>
  <br/>
 </p>
 <dl compact="">
  <dt>
  </dt>
  <dd>
   <pre>
{ "indom":DDDD,
   "instances": [
      { "instance":IIII, "name":"INAME" }
      ...
   ] }

</pre>
  </dd>
 </dl>
 <p>
  <a name="lbAK">
  </a>
 </p>
 <h3>
  INSTANCE PROFILE: pmAddProfile, pmDelProfile
 </h3>
 <p>
  The general form of these requests is as follows:
 </p>
 <dl compact="">
  <dt>
   <b>
    /pmapi/NNNN/_profile_reset?indom=DDDD
   </b>
  </dt>
  <dd>
   These are not currently supported.
  </dd>
  <dt>
   <b>
    /pmapi/NNNN/_profile_add?indom=DDDD&amp;instance=IIII,JJJJ
   </b>
  </dt>
  <dd>
   These are not currently supported.
  </dd>
  <dt>
   <b>
    /pmapi/NNNN/_profile_add?indom=DDDD&amp;iname=IIII,JJJJ
   </b>
  </dt>
  <dd>
   These are not currently supported.
  </dd>
  <dt>
   <b>
    /pmapi/NNNN/_profile_del?indom=DDDD&amp;instance=JJJJ
   </b>
  </dt>
  <dd>
   These are not currently supported.
  </dd>
  <dt>
   <b>
    /pmapi/NNNN/_profile_del?indom=DDDD&amp;iname=INAME1,INAME2
   </b>
  </dt>
  <dd>
   These are not currently supported.
   <p>
   </p>
  </dd>
 </dl>
 <a name="lbAL">
 </a>
 <h3>
  METRIC STORE: pmStore
 </h3>
 <p>
  The general form of these requests is as follows:
 </p>
 <dl compact="">
  <dt>
   <b>
    /pmapi/NNNN/_store?name=NAME&amp;value=VALUE
   </b>
  </dt>
  <dd>
   Store a new value for given named metrics.
  </dd>
  <dt>
   <b>
    /pmapi/NNNNN/_store?pmid=PPPP&amp;value=VALUE
   </b>
  </dt>
  <dd>
   Store a new value for given performance metric identifier (PMID).
  </dd>
 </dl>
 <p>
  In addition, either query may be suffixed with:
 </p>
 <dl compact="">
  <dt>
   <b>
    &amp;instance=IIII,JJJJ
   </b>
  </dt>
  <dd>
   Restrict store to given instance code numbers.
  </dd>
  <dt>
   <b>
    &amp;iname=INAME1,INAME2
   </b>
  </dt>
  <dd>
   Restrict store to given instance names.
  </dd>
 </dl>
 <p>
  If successful, the response from these requests is a JSON document of the form:
 </p>
 <p>
  <br/>
 </p>
 <dl compact="">
  <dt>
  </dt>
  <dd>
   <pre>
{ "success" : true }

</pre>
  </dd>
 </dl>
 <p>
  <a name="lbAM">
  </a>
 </p>
 <h3>
  DERIVED METRICS: pmRegisterDerived
 </h3>
 <p>
 </p>
 <dl compact="">
  <dt>
   <b>
    /pmapi/NNNNN/_derive?name=NAME&amp;expr=EXPRESSION
   </b>
  </dt>
  <dd>
   These are not currently supported.
   <p>
   </p>
  </dd>
 </dl>
 <a name="lbAN">
 </a>
 <h3>
  CONTEXT COPY: pmDupContext
 </h3>
 <p>
 </p>
 <dl compact="">
  <dt>
   <b>
    /pmapi/NNNNN/copy
   </b>
  </dt>
  <dd>
   These are not currently supported.
   <p>
   </p>
  </dd>
 </dl>
 <a name="lbAO">
 </a>
 <h3>
  CONTEXT CLOSE: pmDestroyContext
 </h3>
 <p>
 </p>
 <dl compact="">
  <dt>
   <b>
    /pmapi/NNNNN/destroy
   </b>
  </dt>
  <dd>
   This is not likely to be supported, as it is destructive and would offer
a tempting target to brute-force attackers.  Instead, the pmwebd timeout
is used to automatically free unused contexts.
   <p>
   </p>
  </dd>
 </dl>
 <a name="lbAP">
 </a>
 <h3>
  PROMETHEUS
 </h3>
 <p>
  Prometheus exporting of live metrics from a preexisting PMWEBAPI context
is available:
 </p>
 <p>
  The general form of the requests is:
 </p>
 <dl compact="">
  <dt>
   <b>
    /pmapi/NNNNN/metrics?target=NAME1,NAME2,...
   </b>
  </dt>
  <dd>
   Fetch current values for given named metrics.
  </dd>
 </dl>
 <p>
  For all numeric metrics with the given NAME prefixes, create a
prometheus text export format giving their current value and related
metadata.  The response has text/plain type rather than JSON, and is
designed to be ingested by a Prometheus server, or pcp's own
pmdaprometheus.
 </p>
 <p>
  The native PCP metric metadata (metric name, semantics and units) are first output with the
  <b>
   # PCP
  </b>
  prefix.
If the units string is empty, then
  <b>
   none
  </b>
  is output.
The units metadata string may contain spaces and extends to the end of the line.
Prometheus metric types are heuristically inferred from PCP
metric types, and units/scales are converted to base
seconds/bytes/count if possible, with a corresponding suffix added to
the metric name.
PCP metric names are mapped so that
  <b>
   .
  </b>
  are exchanged with
  <b>
   :
  </b>
  .  Instance domain instances are represented as Prometheus labels
with quoted instance names.
 </p>
 <p>
  <br/>
 </p>
 <dl compact="">
  <dt>
  </dt>
  <dd>
   <pre>
# PCP proc.nprocs instant none
# HELP proc:nprocs instantaneous number of processes
# TYPE proc:nprocs gauge
proc:nprocs 7

# PCP kernel.pernode.cpu.intr counter millisec
# HELP kernel:pernode:cpu:intr_seconds_total total interrupt CPU time from /proc/stat for each node
# TYPE kernel:pernode:cpu:intr_seconds_total counter
kernel:pernode:cpu:intr_seconds_total{instance="node0"} 25603.540000000001

# PCP filesys.blocksize instant byte
# HELP filesys:blocksize_bytes Size of each block on mounted filesystem (Bytes)
# TYPE filesys:blocksize_bytes gauge
filesys:blocksize_bytes{instance="/dev/mapper/docker-253:0-83713-\
9a130460b46163fcf4443710db3159dea6bb5ec2aaca108515839a7a28c191ce"} 4096
filesys:blocksize_bytes{instance="/dev/mapper/VolGroup00-root17"} 4096

</pre>
  </dd>
 </dl>
 <p>
  <a name="lbAQ">
  </a>
 </p>
 <h2>
  GRAPHITE
 </h2>
 <p>
  When enabled, pmwebd can emulate a subset of the graphite web-api to
allow web applications like graphite and grafana to extract data from
all archives under the configured -A directory.  The graphite
namespace is constructed from the PCP archives using a simple mapping
that encodes the Cartesian product of archives, metrics, and
instance-domain instances into dot-separated strings.  Some
metacharacter-quoting is employed to encode general strings into
components.  Only numeric PCP metrics are exposed; COUNTER semantic
values are rate-converted.
 </p>
 <p>
 </p>
 <center>
  <table border="">
   <tr>
    <td>
     <table>
      <tr valign="top">
       <td align="center">
        position
       </td>
       <td align="center">
        number
       </td>
       <td align="center">
        purpose
        <br/>
       </td>
      </tr>
      <tr valign="top">
       <td colspan="3">
        <hr/>
       </td>
      </tr>
      <tr valign="top">
       <td align="center">
        1
       </td>
       <td align="center">
        1
       </td>
       <td>
        encoded pathname of the archive .meta file (default),
        <br/>
       </td>
      </tr>
      <tr valign="top">
       <td align="center">
       </td>
       <td align="center">
       </td>
       <td>
        or canonicalized archive hostname (
        <i>
         -J
        </i>
        mode)
        <br/>
       </td>
      </tr>
      <tr valign="top">
       <td align="center">
        2
       </td>
       <td align="center">
        N
       </td>
       <td>
        the N components of the pcp metric name
        <br/>
       </td>
      </tr>
      <tr valign="top">
       <td align="center">
        N+2
       </td>
       <td align="center">
        1
       </td>
       <td>
        instance name of the metric (if any)
        <br/>
       </td>
      </tr>
     </table>
    </td>
   </tr>
  </table>
 </center>
 <p>
  Since glob wildcarding is supported within metric name components,
using them in the first component (an encoding of the archive name) is
a good way to identify machines, or to match multiple archives
spanning times of interest.
 </p>
 <p>
  We list here only the broadest outline of the supported calls.  pmwebd
does not support every graphite web-api option, so many querystring
parameters may be ignored.  Arithmetic/statistical functions on
metrics are not supported.
 </p>
 <p>
 </p>
 <dl compact="">
  <dt>
   <b>
    /graphite/render?format=json&amp;target=FOO&amp;from=TIME&amp;until=TIME
   </b>
  </dt>
  <dd>
   Return a series of values of the given metrics, between the two times, sampled every 60 seconds.
  </dd>
  <dt>
   <b>
    /graphite/rawdata?target=FOO.BAR&amp;from=TIME&amp;until=TIME
   </b>
  </dt>
  <dd>
   Same, with a slightly different result encoding.
  </dd>
  <dt>
   <b>
    /graphite/render?format=png&amp;target=FOO&amp;from=TIME&amp;until=TIME&amp;....
   </b>
  </dt>
  <dd>
   Same, but render the curves into a PNG image file.  Several color- and
rendering-control-related parameters are supported.
  </dd>
  <dt>
   <b>
    /graphite/metrics/find?query=FOO.BAR.*
   </b>
  </dt>
  <dd>
   Provide incremental metric-tree traversal using wildcards.
  </dd>
  <dt>
   <b>
    /graphite/graphlot/findmetric?query=FOO+BAR
   </b>
  </dt>
  <dd>
   Search through metrics with space-separated regular expressions.
  </dd>
  <dt>
   <b>
    /graphite/browser/search?q=FOO+BAR
   </b>
  </dt>
  <dd>
   Same, with a slightly different result encoding.
   <p>
   </p>
  </dd>
 </dl>
 <a name="lbAR">
 </a>
 <h2>
  SECURITY
 </h2>
 <p>
  <b>
   pmwebd
  </b>
  is suitable for direct exposure to
trusted networks only, due to several security limitations.  Most or
all of these limitations may be worked around by use of a web
application firewall (for example, an Apache HTTP proxy), which would
add the constraints and capabilities absent within
  <b>
   pmwebd
  </b>
  .

Such configuration is beyond the scope of this document.
 </p>
 <dl compact="">
  <dt>
   encryption/confidentiality
  </dt>
  <dd>
   <b>
    pmwebd
   </b>
   does not currently support HTTPS (SSL/TLS), so
the HTTP traffic is not protected against network-level attacks.
  </dd>
  <dt>
   authentication
  </dt>
  <dd>
   The PMAPI layer does not possess a mandatory authentication mechanism,
so any remote connection can access any metric exposed by suchly connected
PMAPI contexts.  However, a new host-context string may use
authentication clauses of the longer host URLs, for example
   <i>
    <a href="pcps://hostname?method=plain">
     pcps://hostname?method=plain
    </a>
    &amp;user=userid&amp;pass=password
   </i>
   .

Use of resulting pmwebapi contexts later requires matching HTTP PLAIN
authentication; see below.
  </dd>
  <dt>
   inbound admission control
  </dt>
  <dd>
   <b>
    pmwebd
   </b>
   does not impose access control on the origin or rate of its incoming requests.
It may be possible for some clients to starve others.
  </dd>
  <dt>
   outbound admission control
  </dt>
  <dd>
   <b>
    pmwebd
   </b>
   does not impose access control on outbound connections
when a new PMAPI context is created for a PMCD.
(Without the
   <b>
    -P
   </b>
   option, connections to UNIX-domain / local PMCDs are blocked.)
This enables hypothetical use of a
   <b>
    pmwebd
   </b>
   instance to be used as a network proxy/scanner.
For an archive type context, the files must be located under the
   <b>
    pmwebd
   </b>
   current directory, or another directory specified by
   <b>
    -A
   </b>
   .

One may entirely disable remotely specified PMAPI context creation using the
   <b>
    -N
   </b>
   option; in this case, specify a static set of contexts using the
   <b>
    -h
   </b>
   ,
   <b>
    -a
   </b>
   ,

and/or
   <b>
    -L
   </b>
   options.
You may assign them arbitrary context numbers with the
   <b>
    -c
   </b>
   option.
  </dd>
  <dt>
   context ownership
  </dt>
  <dd>
   Authenticated PCP contexts are protected by requiring the same HTTP
PLAIN/simple userid/password credentials for related /pmapi requests.
However, unauthenticated contexts for different web clients are kept
distinct only by the assignment of large pseudorandom identifiers.  It
may be possible to find these by brute-force search or other
techniques, thereby letting a web client impersonate another.  For
more privacy of the permanent contexts, use the
   <b>
    -c
   </b>
   option to reset their starting web context identifiers to a number
much different from 1.  On the other hand, context ownership is not
that precious, since there exist no state-destructive operations for
them, except perhaps metric store or instance profile settings.
  </dd>
 </dl>
 <a name="lbAS">
 </a>
 <h2>
  STARTING AND STOPPING PMWEBD
 </h2>
 The
 <b>
  pmwebd
 </b>
 server may be started automatically at boot time and
stopped when the system is being brought down.  Users may also run
customized
 <b>
  pmwebd
 </b>
 instances (under separate
 <b>
  -p
 </b>
 PORT numbers), for
example for their own archive farms.
 <b>
  For management fo the system
 </b>
 <b>
  pmwebd
 </b>
 ,

become superuser and type
 <p>
  # $PCP_RC_DIR/pmwebd start
 </p>
 <p>
  to start
  <b>
   pmwebd
  </b>
  ,

or
 </p>
 <p>
  # $PCP_RC_DIR/pmwebd stop
 </p>
 <p>
  to stop
  <b>
   pmwebd
  </b>
  .

Starting
  <b>
   pmwebd
  </b>
  when it is already running is the same as stopping
it and then starting it again.
  <a name="lbAT">
  </a>
 </p>
 <h2>
  FILES
 </h2>
 <dl compact="">
  <dt>
   <b>
    $PCP_PMWEBDOPTIONS_PATH
   </b>
  </dt>
  <dd>
   command line options
and environment variable settings for
   <b>
    pmwebd
   </b>
   when launched from
   <b>
    $PCP_RC_DIR/pmwebd
   </b>
   This file is interpreted as a Bourne Shell script, expecting
variable settings of the form "OPTIONS=value" and possibly others.
  </dd>
  <dt>
   <b>
    $PCP_LOG_DIR/pmwebd/pmwebd.log
   </b>
  </dt>
  <dd>
   Log file for system
   <b>
    pmwebd
   </b>
   service.
  </dd>
  <dt>
   <b>
    $PCP_LOG_DIR
   </b>
  </dt>
  <dd>
   Default directory for
   <b>
    -A
   </b>
   option: a base directory containing PCP archives.
  </dd>
  <dt>
   <b>
    $PCP_SHARE_DIR/webapps
   </b>
  </dt>
  <dd>
   Default directory for
   <b>
    -R
   </b>
   option: a base directory containing web applications.
  </dd>
 </dl>
 <a name="lbAU">
 </a>
 <h2>
  PCP ENVIRONMENT
 </h2>
 Environment variables with the prefix
 <b>
  PCP_
 </b>
 are used to parameterize the file and directory names
used by PCP.
On each installation, the file
 <i>
  /etc/pcp.conf
 </i>
 contains the local values for these variables.
The
 <b>
  $PCP_CONF
 </b>
 variable may be used to specify an alternative
configuration file,
as described in
 <b>
  <a href="/man/man5/pcp.conf.5.html">
   pcp.conf
  </a>
 </b>
 (5).
 <p>
  <a name="lbAV">
  </a>
 </p>
 <h2>
  SEE ALSO
 </h2>
 <b>
  <a href="/man/man1/pcpintro.1.html">
   PCPIntro
  </a>
 </b>
 (1),
 <b>
  <a href="/man/man3/pcpintro.3.html">
   PCPIntro
  </a>
 </b>
 (3),
 <b>
  <a href="/man/man3/pmapi.3.html">
   PMAPI
  </a>
 </b>
 (3),
 <b>
  <a href="/man/man3/pmwebapi.3.html">
   PMWEBAPI
  </a>
 </b>
 (3),
 <b>
  <a href="/man/man3/pmspeclocalpmda.3.html">
   pmSpecLocalPMDA
  </a>
 </b>
 (3),
 <b>
  <a href="/man/man5/pcp.conf.5.html">
   pcp.conf
  </a>
 </b>
 (5),
 <b>
  <a href="/man/man5/pcp.env.5.html">
   pcp.env
  </a>
 </b>
 (5)
 <b>
  <a href="http://graphite.readthedocs.org/">
   http://graphite.readthedocs.org/
  </a>
 </b>
 and
 <b>
  <a href="/man/man5/pmns.5.html">
   pmns
  </a>
 </b>
 (5).
 <p>
 </p>
 <hr/>
 <a name="index">
 </a>
 <h2>
  Index
 </h2>
 <dl>
  <dt>
   <a href="#lbAB">
    NAME
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAC">
    SYNOPSIS
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAD">
    DESCRIPTION
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAE">
    CONTEXT CREATION: pmNewContext
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAF">
    CONTEXT CREATION: configurable permanent contexts
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAG">
    PMAPI OPERATIONS
   </a>
  </dt>
  <dd>
   <dl>
    <dt>
     <a href="#lbAH">
      METRIC METADATA: pmLookupName, pmLookupDesc, pmLookupText, pmTraversePMNS_r
     </a>
    </dt>
    <dd>
    </dd>
    <dt>
     <a href="#lbAI">
      METRIC VALUE: pmFetch
     </a>
    </dt>
    <dd>
    </dd>
    <dt>
     <a href="#lbAJ">
      INSTANCE DOMAINS METADATA: pmGetInDom, pmNameInDom, pmLookupInDom
     </a>
    </dt>
    <dd>
    </dd>
    <dt>
     <a href="#lbAK">
      INSTANCE PROFILE: pmAddProfile, pmDelProfile
     </a>
    </dt>
    <dd>
    </dd>
    <dt>
     <a href="#lbAL">
      METRIC STORE: pmStore
     </a>
    </dt>
    <dd>
    </dd>
    <dt>
     <a href="#lbAM">
      DERIVED METRICS: pmRegisterDerived
     </a>
    </dt>
    <dd>
    </dd>
    <dt>
     <a href="#lbAN">
      CONTEXT COPY: pmDupContext
     </a>
    </dt>
    <dd>
    </dd>
    <dt>
     <a href="#lbAO">
      CONTEXT CLOSE: pmDestroyContext
     </a>
    </dt>
    <dd>
    </dd>
    <dt>
     <a href="#lbAP">
      PROMETHEUS
     </a>
    </dt>
    <dd>
    </dd>
   </dl>
  </dd>
  <dt>
   <a href="#lbAQ">
    GRAPHITE
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAR">
    SECURITY
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAS">
    STARTING AND STOPPING PMWEBD
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAT">
    FILES
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAU">
    PCP ENVIRONMENT
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAV">
    SEE ALSO
   </a>
  </dt>
  <dd>
  </dd>
 </dl>
 
</div>
</div>
</div>
</div>
</div>
<footer class='global-footer is-typeset'>
<div class='row-parent'>
<div class='row'>
<section class='row__colspaced'>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>Main Menu</h4>
<ul>
<li>
<a href='/features.html'>Features</a>
</li>
<li>
<a href='/documentation.html'>Documentation</a>
</li>
<li>
<a class='download' href='/download.html'>Download</a>
</li>
</ul>
</div>
</div>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>Developers</h4>
<ul>
<li>
<a href='https://github.com/performancecopilot/pcp/issues'>Report an issue</a>
</li>
<li>
<a href='https://github.com/performancecopilot/pcp/projects/1'>Roadmap</a>
</li>
<li>
<a href='/community.html'>Contributing</a>
</li>
<li>
<a href='/team.html'>Team</a>
</li>
</ul>
</div>
</div>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>About</h4>
<ul>
<li>
<a href='/testimonials.html'>Testimonials</a>
</li>
<li>
<a href='/faq.html'>FAQ</a>
</li>
<li>
<a href='/website.html'>Website</a>
</li>
</ul>
</div>
</div>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>Get Social</h4>
<ul>
<li>
<a class='twitter' href='https://twitter.com/performancepcp' rel='external'>Twitter</a>
</li>
<li>
<a class='github' href='https://github.com/performancecopilot' rel='external'>Github</a>
</li>
</ul>
</div>
</div>
</section>
</div>
<div class='row'>
<div class='colspan2-2'>
<p class='legal'>
This website is Copyright &copy; 2000-2004 Silicon Graphics Inc, 2007-2010 Aconex, 2012-2019 Red Hat
</p>
</div>
</div>
</div>
</footer>

</body>
</html>
