<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='initial-scale=1' name='viewport'>
<title>Performance Co-Pilot</title>
<link href='/assets/css/screen.css' media='all' rel='stylesheet' type='text/css'>
<link href='/assets/css/master.css' media='all' rel='stylesheet' type='text/css'>
<link href='/images/pcp.ico' rel='shortcut icon' type='image/ico'>

</head>
<body>
<header class='global-header'>
<div class='row'>
<h1 class='global-logo colspan12-6 colspan8-4 colspan6-3 colspan2-1 as-grid'>
<a href='/index.html'>Performance Co-Pilot</a>
</h1>
<nav class='global-header__navigation colspan12-6 colspan8-6 colspan6-4 colspan2-1 as-grid'>
<ul>
<li>
<a href='/features.html'>Features</a>
</li>
<li>
<a href='/documentation.html'>Documentation</a>
</li>
<li>
<a href='/download.html'>Download</a>
</li>
<li>
<a href='/community.html'>Get Involved</a>
</li>
</ul>
</nav>
</div>
</header>

<div class='site-content'>
<div class='how-to is-typeset'>
<div class='row-parent'>
<div class='row'>
<div class='manpage'>
ï»¿
 <h1>
  PMCD
 </h1>
 Section: User Commands  (1)
 <br/>
 <a href="#index">
  Index
 </a>
 <a href="/man">
  Return to Main Contents
 </a>
 <hr/>
 <a name="lbAB">
 </a>
 <h2>
  NAME
 </h2>
 <b>
  pmcd
 </b>
 - performance metrics collector daemon
 <a name="lbAC">
 </a>
 <h2>
  SYNOPSIS
 </h2>
 <b>
  pmcd
 </b>
 [
 <b>
  -AfQSv?
 </b>
 ]
[
 <b>
  -c
 </b>
 <i>
  config
 </i>
 ]
[
 <b>
  -C
 </b>
 <i>
  dirname
 </i>
 ]
[
 <b>
  -H
 </b>
 <i>
  hostname
 </i>
 ]
[
 <b>
  -i
 </b>
 <i>
  ipaddress
 </i>
 ]
[
 <b>
  -l
 </b>
 <i>
  logfile
 </i>
 ]
[
 <b>
  -L
 </b>
 <i>
  bytes
 </i>
 ]
[
 <b>
  -M
 </b>
 <i>
  certname
 </i>
 ]
[
 <b>
  -
 </b>
 [
 <b>
  n
 </b>
 |
 <b>
  N
 </b>
 ]
 <i>
  pmnsfile
 </i>
 ]
[
 <b>
  -p
 </b>
 <i>
  port
 </i>
 [,
 <i>
  port
 </i>
 ...]]
[
 <b>
  -P
 </b>
 <i>
  passfile
 </i>
 ]
[
 <b>
  -q
 </b>
 <i>
  timeout
 </i>
 ]
[
 <b>
  -s
 </b>
 <i>
  sockname
 </i>
 ]
[
 <b>
  -t
 </b>
 <i>
  timeout
 </i>
 ]
[
 <b>
  -T
 </b>
 <i>
  traceflag
 </i>
 ]
[
 <b>
  -U
 </b>
 <i>
  username
 </i>
 ]
[
 <b>
  -x
 </b>
 <i>
  file
 </i>
 ]
 <a name="lbAD">
 </a>
 <h2>
  DESCRIPTION
 </h2>
 <b>
  pmcd
 </b>
 is the collector used by the Performance Co-Pilot (see
 <b>
  <a href="/man/man1/pcpintro.1.html">
   PCPIntro
  </a>
 </b>
 (1))

to gather performance metrics
on a system.
As a rule, there must be an instance of
 <b>
  pmcd
 </b>
 running on a system for any performance metrics to be available to the
PCP.
 <p>
  <b>
   pmcd
  </b>
  accepts connections from client applications running either on
the same machine or remotely and provides them with metrics and other related
information from the machine that
  <b>
   pmcd
  </b>
  is executing on.
  <b>
   pmcd
  </b>
  delegates most of this request servicing to
a collection of Performance Metrics Domain Agents
(or just agents), where each agent is responsible for a particular group of
metrics, known as the domain of the agent.
For instance, the
  <b>
   postgresql
  </b>
  agent is responsible for
reporting information relating to the PostgreSQL database,
such as the transaction and query counts, indexing and replication statistics,
and so on.
 </p>
 <p>
  The agents may be processes started by
  <b>
   pmcd
  </b>
  ,

independent processes or Dynamic Shared Objects (DSOs, see
  <b>
   <a href="http://man7.org/linux/man-pages/man3/dlopen.3.html">
    dlopen
   </a>
  </b>
  (3))

attached to
  <b>
   pmcd
  </b>
  's

address space.
The configuration section below describes how connections to
agents are specified.
 </p>
 <p>
  Note that if a PDU exchange with an agent times out, the agent has
violated the requirement that it delivers metrics with little or no delay.
This is deemed a
protocol failure and the agent is disconnected from
  <b>
   pmcd
  </b>
  .

Any subsequent requests for information from the agent will fail with a status
indicating that there is no agent to provide it.
 </p>
 <p>
  It is possible to specify access control to
  <b>
   pmcd
  </b>
  based on users, groups and hosts.
This allows one to prevent users, groups of users, and certain hosts from
accessing the metrics provided by
  <b>
   pmcd
  </b>
  and is described in more detail in the access control section below.
  <a name="lbAE">
  </a>
 </p>
 <h2>
  OPTIONS
 </h2>
 The available command line options are:
 <dl compact="">
  <dt>
   <b>
    -A
   </b>
  </dt>
  <dd>
   Disable service advertisement.
By default,
   <b>
    pmcd
   </b>
   will advertise its presence on the network using any available mechanisms
(such as Avahi/DNS-SD), assisting remote monitoring tools with finding it.
These mechanisms are disabled with this option.
  </dd>
  <dt>
   <b>
    -c
   </b>
   <i>
    config
   </i>
   ,
   <b>
    --config
   </b>
   =
   <i>
    config
   </i>
  </dt>
  <dd>
   On startup
   <b>
    pmcd
   </b>
   uses a configuration file from either the
   <i>
    $PCP_PMCDCONF_PATH
   </i>
   ,

configuration variable in
   <i>
    /etc/pcp.conf
   </i>
   ,

or an environment variable of the same name.
However, these values may be overridden with
   <i>
    config
   </i>
   using this option.
The format of this configuration file is described below.
  </dd>
  <dt>
   <b>
    -C
   </b>
   <i>
    dirname
   </i>
   ,
   <b>
    --certdb
   </b>
   =
   <i>
    dirname
   </i>
  </dt>
  <dd>
   Specify the path to the Network Security Services certificate database,
for (optional) secure connections.
The default is
   <b>
    /etc/pki/nssdb
   </b>
   .

Refer also to the
   <b>
    -P
   </b>
   option.
If it does not already exist, this database can be created using the
   <b>
    certutil
   </b>
   utility.
This process and other certificate database maintenance information
is provided in the
   <b>
    <a href="/man/man1/pcpintro.1.html">
     PCPIntro
    </a>
   </b>
   (1)

manual page and the online PCP tutorials.
  </dd>
  <dt>
   <b>
    -f
   </b>
   ,
   <b>
    --foreground
   </b>
  </dt>
  <dd>
   By default
   <b>
    pmcd
   </b>
   is started as a daemon.
The
   <b>
    -f
   </b>
   option indicates that it should run in the foreground.
This is most useful when trying to diagnose problems with misbehaving
agents.
  </dd>
  <dt>
   <b>
    -H
   </b>
   <i>
    hostname
   </i>
   ,
   <b>
    --hostname
   </b>
   =
   <i>
    hostname
   </i>
  </dt>
  <dd>
   This option can be used to set the hostname that
   <b>
    pmcd
   </b>
   will use to represent this instance of itself.
This is used by client tools like
   <b>
    <a href="/man/man1/pmlogger.1.html">
     pmlogger
    </a>
   </b>
   (1)

when reporting on the (possibly remote) host.
If this option is not set, the pmcd.hostname metric will match that
returned by
   <b>
    <a href="/man/man1/pmhostname.1.html">
     pmhostname
    </a>
   </b>
   (1).

Refer to the manual page for that tool for full details on how the hostname is
evaluated.
  </dd>
  <dt>
   <b>
    -i
   </b>
   <i>
    ipaddress
   </i>
   ,
   <b>
    --interface
   </b>
   =
   <i>
    ipaddress
   </i>
  </dt>
  <dd>
   This option is usually only used on hosts with more than one network
interface.
If no
   <b>
    -i
   </b>
   options are specified
   <b>
    pmcd
   </b>
   accepts connections made to any of its host's IP (Internet Protocol) addresses.
The
   <b>
    -i
   </b>
   option is used to specify explicitly an IP address that connections should be
accepted on.
   <i>
    ipaddress
   </i>
   should be in the standard dotted form (e.g. 100.23.45.6).
The
   <b>
    -i
   </b>
   option may be used multiple times to define a list of IP addresses.
Connections made to any other IP addresses the host has will be refused.
This can be used to limit connections to one network interface if the host
is a network gateway.
It is also useful if the host takes over the IP address of
another host that has failed.
In such a situation only the standard IP addresses of the host should be
given (not the ones inherited from the failed host).
This allows PCP applications to determine that a host has failed,
rather than connecting to the host that has assumed the identity of the failed
host.
  </dd>
  <dt>
   <b>
    -l
   </b>
   <i>
    logfile
   </i>
   ,
   <b>
    --log
   </b>
   =
   <i>
    logfile
   </i>
  </dt>
  <dd>
   By default a log file named
   <i>
    pmcd.log
   </i>
   is written in the directory
   <b>
    $PCP_LOG_DIR/pmcd
   </b>
   .

The
   <b>
    -l
   </b>
   option causes the log file to be written to
   <i>
    logfile
   </i>
   instead of the default.
If the log file cannot be created or is not writable, output is
written to the standard error instead.
  </dd>
  <dt>
   <b>
    -L
   </b>
   <i>
    bytes
   </i>
  </dt>
  <dd>
   <i>
    PDU
   </i>
   s

received by
   <b>
    pmcd
   </b>
   from monitoring clients are restricted to a
maximum size of 65536 bytes by default to defend against Denial of
Service attacks.
The
   <b>
    -L
   </b>
   option may be used to change the maximum incoming
   <i>
    PDU
   </i>
   size.
  </dd>
  <dt>
   <b>
    -M
   </b>
   <i>
    certname
   </i>
   ,
   <b>
    --certname
   </b>
   =
   <i>
    certname
   </i>
  </dt>
  <dd>
   By default, pmcd will try to use a certificate called
   <b>
    PCP Collector certificate
   </b>
   .

The
   <b>
    -M
   </b>
   option allows this to be changed.
  </dd>
  <dt>
   <b>
    -n
   </b>
   <i>
    pmnsfile
   </i>
   ,
   <b>
    --namespace
   </b>
   =
   <i>
    pmnsfile
   </i>
  </dt>
  <dd>
   Normally
   <b>
    pmcd
   </b>
   loads the default Performance Metrics Name Space (PMNS) from
   <b>
    $PCP_VAR_DIR/pmns/root
   </b>
   ,

however if the
   <b>
    -n
   </b>
   option is specified an alternative namespace is loaded
from the file
   <i>
    pmnsfile
   </i>
   .
  </dd>
  <dt>
   <b>
    -N
   </b>
   <i>
    pmnsfile
   </i>
   ,
   <b>
    --uniqnames
   </b>
   =
   <i>
    pmnsfile
   </i>
  </dt>
  <dd>
   Same function as
   <b>
    -n
   </b>
   ,

except for the handling of
duplicate Performance Metric Identifiers (PMIDs) in
   <i>
    pmnsfile
   </i>
   - duplicate names are allowed with
   <b>
    -n
   </b>
   but they are not allowed with
   <b>
    -N
   </b>
   .
  </dd>
  <dt>
   <b>
    -P
   </b>
   <i>
    passfile
   </i>
   ,
   <b>
    --passfile
   </b>
   =
   <i>
    passfile
   </i>
  </dt>
  <dd>
   Specify the path to a file containing the Network Security Services certificate
database password for (optional) secure connections, and for databases that are
password protected.
Refer also to the
   <b>
    -C
   </b>
   option.
When using this option, great care should be exercised to ensure appropriate
ownership ("pcp" user, typically) and permissions on this file (0400, so as to
be unreadable by any user other than the user running the
   <b>
    pmcd
   </b>
   process).
  </dd>
  <dt>
   <b>
    -q
   </b>
   <i>
    timeout
   </i>
  </dt>
  <dd>
   The pmcd to agent version exchange protocol (new in PCP 2.0 - introduced to
provide backward compatibility) uses this timeout to specify how long pmcd
should wait before assuming that no version response is coming from an agent.
If this timeout is reached, the agent is assumed to be an agent which does
not understand the PCP 2.0 protocol.
The default timeout interval is five seconds,
but the
   <b>
    -q
   </b>
   option allows an alternative timeout interval (which must be greater than
zero) to be specified.
The unit of time is seconds.
  </dd>
  <dt>
   <b>
    -Q
   </b>
   ,
   <b>
    --remotecert
   </b>
  </dt>
  <dd>
   Require that all remote client connections provide a certficate.
  </dd>
  <dt>
   <b>
    -s
   </b>
   <i>
    sockname
   </i>
   ,
   <b>
    --socket
   </b>
   =
   <i>
    sockname
   </i>
  </dt>
  <dd>
   Specify the path to a local unix domain socket (for platforms supporting this
socket family only).
The default value is
   <i>
    $PCP_RUN_DIR/pmcd.socket
   </i>
   .
  </dd>
  <dt>
   <b>
    -S
   </b>
   ,
   <b>
    --allcert
   </b>
  </dt>
  <dd>
   Require that all client connections provide user credentials.
This means that only unix domain sockets, or authenticated connections are
permitted (requires secure sockets support).
If any user or group access control requirements are specified in the pmcd
configuration file, then this mode of operation is automatically entered,
whether the
   <b>
    -S
   </b>
   flag is specified or not.
  </dd>
  <dt>
   <b>
    -t
   </b>
   <i>
    timeout
   </i>
  </dt>
  <dd>
   To prevent misbehaving clients or agents from hanging the entire Performance Metrics
Collection System (PMCS),
   <b>
    pmcd
   </b>
   uses timeouts on PDU exchanges with clients and agents running as processes.
By
default the timeout interval is five seconds.
The
   <b>
    -t
   </b>
   option allows an alternative timeout interval in seconds to be specified.
If
   <i>
    timeout
   </i>
   is zero, timeouts are turned off.
It is almost impossible to use the debugger
interactively on an agent unless timeouts have been turned off for its "parent"
   <b>
    pmcd
   </b>
   .
   <dl compact="">
    <dt>
    </dt>
    <dd>
     <p>
      Once
      <b>
       pmcd
      </b>
      is running, the timeout may be dynamically
modified by storing an integer value (the timeout in seconds)
into the metric
      <b>
       pmcd.control.timeout
      </b>
      via
      <b>
       <a href="/man/man1/pmstore.1.html">
        pmstore
       </a>
      </b>
      (1).
     </p>
    </dd>
   </dl>
  </dd>
  <dt>
   <b>
    -T
   </b>
   <i>
    traceflag
   </i>
   ,
   <b>
    --trace
   </b>
   =
   <i>
    traceflag
   </i>
  </dt>
  <dd>
   To assist with error diagnosis for agents and/or clients of
   <b>
    pmcd
   </b>
   that are not behaving correctly, an internal event tracing
mechanism is supported within
   <b>
    pmcd
   </b>
   .

The value of
   <i>
    traceflag
   </i>
   is interpreted as a bit field with the following control functions:
   <dl compact="">
    <dt>
    </dt>
    <dd>
     <dl compact="">
      <dt>
      </dt>
      <dd>
       <b>
        1
       </b>
       enable client connection tracing
      </dd>
      <dt>
       <b>
        2
       </b>
      </dt>
      <dd>
       enable PDU tracing
      </dd>
      <dt>
       <b>
        256
       </b>
      </dt>
      <dd>
       unbuffered event tracing
      </dd>
     </dl>
     <p>
      By default, event tracing is buffered using
a circular buffer that is over-written as new
events are recorded.
The default buffer size holds the last 20 events, although this number
may be over-ridden by using
      <b>
       <a href="/man/man1/pmstore.1.html">
        pmstore
       </a>
      </b>
      (1)

to modify the metric
      <b>
       pmcd.control.tracebufs
      </b>
      .
     </p>
     <p>
      Similarly once
      <b>
       pmcd
      </b>
      is running, the event tracing control
may be dynamically
modified by storing 1 (enable) or
0 (disable) into the metrics
      <b>
       pmcd.control.traceconn
      </b>
      ,
      <b>
       pmcd.control.tracepdu
      </b>
      and
      <b>
       pmcd.control.tracenobuf
      </b>
      .

These metrics map to the bit fields associated with the
      <i>
       traceflag
      </i>
      argument for the
      <b>
       -T
      </b>
      option.
     </p>
     <p>
      When operating in buffered mode,
the event trace buffer will be dumped whenever an agent connection is
terminated by
      <b>
       pmcd
      </b>
      ,

or when any value is stored into the metric
      <b>
       pmcd.control.dumptrace
      </b>
      via
      <b>
       <a href="/man/man1/pmstore.1.html">
        pmstore
       </a>
      </b>
      (1).
     </p>
     <p>
      In unbuffered mode,
      <b>
       every
      </b>
      event will be reported when it occurs.
     </p>
    </dd>
   </dl>
  </dd>
  <dt>
   <b>
    -U
   </b>
   <i>
    username
   </i>
   ,
   <b>
    --username
   </b>
   =
   <i>
    USER
   </i>
  </dt>
  <dd>
   User account under which to run
   <b>
    pmcd
   </b>
   .

The default is the unprivileged "pcp" account in current versions of PCP,
but in older versions the superuser account ("root") was used by default.
  </dd>
  <dt>
   <b>
    -v
   </b>
   ,
   <b>
    --verify
   </b>
  </dt>
  <dd>
   Verify the
   <b>
    pmcd
   </b>
   configuration file, reporting on any errors then exiting with a status
indicating verification success or failure.
  </dd>
  <dt>
   <b>
    -x
   </b>
   <i>
    file
   </i>
  </dt>
  <dd>
   Before the
   <b>
    pmcd
   </b>
   <i>
    logfile
   </i>
   can be opened,
   <b>
    pmcd
   </b>
   may encounter a fatal error which prevents it from starting.
By default, the output describing this error is sent to
   <b>
    /dev/tty
   </b>
   but it may redirected to
   <i>
    file
   </i>
   .
  </dd>
  <dt>
   <b>
    -?
   </b>
   ,
   <b>
    --help
   </b>
  </dt>
  <dd>
   Display usage message and exit.
  </dd>
 </dl>
 <a name="lbAF">
 </a>
 <h2>
  CONFIGURATION
 </h2>
 On startup
 <b>
  pmcd
 </b>
 looks for a configuration file named
 <i>
  $PCP_PMCDCONF_PATH
 </i>
 .

This file specifies which agents cover which performance metrics domains and
how
 <b>
  pmcd
 </b>
 should make contact with the agents.
An optional section specifying access controls may follow the agent
configuration data.
 <p>
  <b>
   Warning
  </b>
  :
  <b>
   pmcd
  </b>
  is usually started as part of the boot sequence and runs initially as root.
The configuration file may contain shell commands to create agents,
which will be executed by root.
To prevent security breaches the configuration file should
be writable only by root.
The use of absolute path names is also recommended.
 </p>
 <p>
  The case of the reserved words in the configuration file is unimportant, but
elsewhere, the case is preserved.
 </p>
 <p>
  Blank lines and comments are permitted (even encouraged) in the configuration
file.
A comment begins with a ``#''
character and finishes at the end of the line.
A line may be continued by
ensuring that the last character on the line is a ``\''
(backslash).
A comment on a continued line ends at the end of the continued
line.
Spaces may be included in lexical elements by enclosing the entire
element in double quotes.
A double quote preceded by a backslash is always a
literal double quote.
A ``#''
in double quotes or preceded by a backslash is treated literally rather than as
a comment delimiter.
Lexical elements and separators are described further in
the following sections.
  <a name="lbAG">
  </a>
 </p>
 <h2>
  AGENT CONFIGURATION
 </h2>
 Each line of the agent configuration section of the configuration file contains
details of how to connect
 <b>
  pmcd
 </b>
 to one of its agents and specifies which metrics domain the agent deals with.
An agent may be attached as a DSO, or via a socket, or a pair
of pipes.
 <p>
  Each line of the agent configuration section of the configuration file must be
either an agent specification, a comment, or a blank line.
Lexical elements
are separated by whitespace characters, however a single agent specification
may not be broken across lines unless a
  <b>
   \\
  </b>
  (backslash) is used to continue the line.
 </p>
 <p>
  Each agent specification must start with a textual label (string) followed by
an integer in the range 1 to 510.
The label is a tag used to refer to the
agent and the integer specifies the domain for which the agent supplies data.
This domain identifier corresponds to the domain portion of the PMIDs handled
by the agent.
Each agent must have a unique label and domain identifier.
 </p>
 <p>
  For DSO agents a line of the form:
 </p>
 <dl compact="">
  <dt>
  </dt>
  <dd>
   <i>
    label
   </i>
   <i>
    domain-no
   </i>
   <b>
    dso
   </b>
   <i>
    entry-point
   </i>
   <i>
    path
   </i>
  </dd>
 </dl>
 <p>
  should appear.
Where,
 </p>
 <dl compact="">
  <dt>
  </dt>
  <dd>
   <i>
    label
   </i>
   is a string identifying the agent
  </dd>
  <dt>
   <i>
    domain-no
   </i>
  </dt>
  <dd>
   is an unsigned integer specifying the agent's domain in the range 1 to 510
  </dd>
  <dt>
   <i>
    entry-point
   </i>
  </dt>
  <dd>
   is the name of an initialization function which will be called when the DSO is
loaded
  </dd>
  <dt>
   <i>
    path
   </i>
  </dt>
  <dd>
   designates the location of the DSO and this is expected
to be an absolute pathname.
   <b>
    pmcd
   </b>
   is only able to load DSO agents that have the same
   <i>
    simabi
   </i>
   (Subprogram Interface Model ABI, or calling conventions) as it does (i.e. only
one of the
   <i>
    simabi
   </i>
   versions will be applicable).
The
   <i>
    simabi
   </i>
   version of a running
   <b>
    pmcd
   </b>
   may be determined by fetching
   <b>
    pmcd.simabi
   </b>
   .

Alternatively, the
   <b>
    <a href="http://man7.org/linux/man-pages/man1/file.1.html">
     file
    </a>
   </b>
   (1)

command may be used to determine the
   <i>
    simabi
   </i>
   version from the
   <b>
    pmcd
   </b>
   executable.
  </dd>
  <dt>
  </dt>
  <dd>
   For a relative
   <i>
    path
   </i>
   the environment variable
   <b>
    PMCD_PATH
   </b>
   defines a colon (:) separated list of directories to search
when trying to locate the agent DSO.
The default search path is
   <b>
    $PCP_SHARE_DIR/lib:/usr/pcp/lib
   </b>
   .
  </dd>
 </dl>
 <p>
  For agents providing socket connections, a line of the form
 </p>
 <dl compact="">
  <dt>
  </dt>
  <dd>
   <i>
    label
   </i>
   <i>
    domain-no
   </i>
   <b>
    socket
   </b>
   <i>
    addr-family
   </i>
   <i>
    address
   </i>
   [
   <i>
    command
   </i>
   ]
  </dd>
 </dl>
 <p>
  should appear.
Where,
 </p>
 <dl compact="">
  <dt>
  </dt>
  <dd>
   <i>
    label
   </i>
   is a string identifying the agent
  </dd>
  <dt>
   <i>
    domain-no
   </i>
  </dt>
  <dd>
   is an unsigned integer specifying the agent's domain in the range 1 to 510
  </dd>
  <dt>
   <i>
    addr-family
   </i>
  </dt>
  <dd>
   designates whether the socket is in the
   <b>
    AF_INET,
   </b>
   <b>
    AF_INET6
   </b>
   or
   <b>
    AF_UNIX
   </b>
   domain, and the corresponding
values for this parameter are
   <b>
    inet,
   </b>
   <b>
    ipv6
   </b>
   and
   <b>
    unix
   </b>
   respectively.
  </dd>
  <dt>
   <i>
    address
   </i>
  </dt>
  <dd>
   specifies the address of the socket within the previously
specified
   <i>
    addr-family.
   </i>
   For
   <b>
    unix
   </b>
   sockets, the address should be the name of an agent's socket on the
local host (a valid address for the UNIX domain).
For
   <b>
    inet
   </b>
   and
   <b>
    ipv6
   </b>
   sockets, the address may be either a port number or a port name which may be
used to connect to an agent on the local host.
There is no syntax for
specifying an agent on a remote host as a
   <b>
    pmcd
   </b>
   deals only with agents on the same machine.
  </dd>
  <dt>
   <i>
    command
   </i>
  </dt>
  <dd>
   is an optional parameter used to specify a command line to start the agent when
   <b>
    pmcd
   </b>
   initializes.
If
   <i>
    command
   </i>
   is not present,
   <b>
    pmcd
   </b>
   assumes that the specified agent has
already been created.
The
   <i>
    command
   </i>
   is considered to start from the first non-white character after the socket
address and finish at the next newline that isn't preceded by a backslash.
After a
   <b>
    <a href="http://man7.org/linux/man-pages/man2/fork.2.html">
     fork
    </a>
   </b>
   (2)

the
   <i>
    command
   </i>
   is passed unmodified to
   <b>
    <a href="http://man7.org/linux/man-pages/man2/execve.2.html">
     execve
    </a>
   </b>
   (2)

to instantiate the agent.
  </dd>
 </dl>
 <p>
  For agents interacting with the
  <b>
   pmcd
  </b>
  via stdin/stdout, a line of the form:
 </p>
 <dl compact="">
  <dt>
  </dt>
  <dd>
   <i>
    label
   </i>
   <i>
    domain-no
   </i>
   <b>
    pipe
   </b>
   <i>
    protocol
   </i>
   <i>
    command
   </i>
  </dd>
 </dl>
 <p>
  should appear.
Where,
 </p>
 <dl compact="">
  <dt>
  </dt>
  <dd>
   <i>
    label
   </i>
   is a string identifying the agent
  </dd>
  <dt>
   <i>
    domain-no
   </i>
  </dt>
  <dd>
   is an unsigned integer specifying the agent's domain
  </dd>
  <dt>
   <i>
    protocol
   </i>
  </dt>
  <dd>
   The value for this parameter should be
   <b>
    binary
   </b>
   .
   <p>
   </p>
  </dd>
  <dt>
  </dt>
  <dd>
   Additionally, the
   <i>
    protocol
   </i>
   can include the
   <b>
    notready
   </b>
   keyword
to indicate that the agent must be marked as not being ready to process
requests from
   <b>
    pmcd
   </b>
   .
The agent will explicitly notify the
   <b>
    pmcd
   </b>
   when it is ready to
process the requests by sending a
   <b>
    PM_ERR_PMDAREADY
   </b>
   PDU.
For further details of this protocol, including a description of the
IPC parameters that can be specified in a PMDA
   <b>
    Install
   </b>
   script with the
   <b>
    ipc_prot
   </b>
   parameter,
see the relevant section in
   <b>
    <a href="/man/man3/pmda.3.html">
     PMDA
    </a>
   </b>
   (3).
  </dd>
  <dt>
   <i>
    command
   </i>
  </dt>
  <dd>
   specifies a command line to start the agent when
   <b>
    pmcd
   </b>
   initializes.
Note that
   <i>
    command
   </i>
   is mandatory for pipe-based agents.
The
   <i>
    command
   </i>
   is considered to start from the first non-white character after the
   <i>
    protocol
   </i>
   parameter and finish at the next newline that isn't preceded by a backslash.
After a
   <b>
    <a href="http://man7.org/linux/man-pages/man2/fork.2.html">
     fork
    </a>
   </b>
   (2)

the
   <i>
    command
   </i>
   is passed unmodified to
   <b>
    <a href="http://man7.org/linux/man-pages/man2/execve.2.html">
     execve
    </a>
   </b>
   (2)

to instantiate the agent.
  </dd>
 </dl>
 <a name="lbAH">
 </a>
 <h2>
  ACCESS CONTROL CONFIGURATION
 </h2>
 The access control section of the configuration file is optional, but if
present it must follow the agent configuration data.
The case of reserved words is ignored, but elsewhere case is preserved.
Lexical elements in the access control section are separated by whitespace
or the special delimiter characters:
square brackets (``['' and ``]''),
braces (``{'' and ``}''),
colon (``:''),
semicolon (``;'')
and
comma (``,'').
The special characters are not treated as special in the agent configuration
section.
Lexical elements may be quoted (double quotes) as necessary.
 <p>
  The access control section of the file must start with a line of the form:
 </p>
 <dl compact="">
  <dt>
   <b>
    [access]
   </b>
  </dt>
  <dd>
  </dd>
 </dl>
 <p>
  In addition to (or instead of) the access section in the
  <b>
   pmcd
  </b>
  configuration file, access control specifications are also
read from a file having the same name as the
  <b>
   pmcd
  </b>
  configuration file, but with '.access' appended to the name.
This optional file must not contain the
  <b>
   [access]
  </b>
  keyword.
 </p>
 <p>
  Leading and trailing whitespace may appear around and within the brackets and
the case of the
  <b>
   access
  </b>
  keyword is ignored.
No other text may appear on the line except a trailing comment.
 </p>
 <p>
  Following this line, the remainder of the configuration file should contain
lines that allow or disallow operations from particular hosts or groups of
hosts.
 </p>
 <p>
  There are two kinds of operations that occur via
  <b>
   pmcd
  </b>
  :
 </p>
 <dl compact="">
  <dt>
   <b>
    fetch
   </b>
  </dt>
  <dd>
   allows retrieval of information from
   <b>
    pmcd
   </b>
   .

This may be information about a metric (e.g. its description, instance domain,
labels or help text) or a value for a metric.
See
   <b>
    <a href="/man/man1/pminfo.1.html">
     pminfo
    </a>
   </b>
   (1)

for further information.
  </dd>
  <dt>
   <b>
    store
   </b>
  </dt>
  <dd>
   allows
   <b>
    pmcd
   </b>
   to be used to store metric values in agents that permit store operations.
This may be the actual value of the metric (e.g. resetting a counter to
zero).
Alternatively, it may be a value used by the PMDA to introduce a
change to some aspect of monitoring of that metric (e.g. server side event
filtering) - possibly even only for the active client tool performing the
store operation, and not others.
See
   <b>
    <a href="/man/man1/pmstore.1.html">
     pmstore
    </a>
   </b>
   (1)

for further information.
  </dd>
 </dl>
 <p>
  Access to
  <b>
   pmcd
  </b>
  can be granted in three ways - by user, group of users, or at a host level.
In the latter, all users on a host are granted the same level of access,
unless the user or group access control mechanism is also in use.
 </p>
 <p>
  User names and group names will be verified using the local
  <b>
   /etc/passwd
  </b>
  and
  <b>
   /etc/groups
  </b>
  files (or an alternative directory service), using the
  <b>
   <a href="http://man7.org/linux/man-pages/man3/getpwent.3.html">
    getpwent
   </a>
  </b>
  (3)

and
  <b>
   <a href="http://man7.org/linux/man-pages/man3/getgrent.3.html">
    getgrent
   </a>
  </b>
  (3)

routines.
 </p>
 <p>
  Hosts may be identified by name, IP address, IPv6 address or by the special host
specifications ``"unix:"'' or ``"local:"''.
``"unix:"'' refers to
  <b>
   pmcd's
  </b>
  unix domain socket, on supported platforms.
``"local:"'' is equivalent to specifying ``"unix:"'' and ``localhost``.
 </p>
 <p>
  Wildcards may also be specified by ending the host identifier with the
single wildcard character ``*'' as the last-given component of an
address.
The wildcard ``".*"'' refers to all inet (IPv4) addresses.
The wildcard ``":*"'' refers to all IPv6 addresses.
If an IPv6 wildcard contains a ``::''
component, then the final ``*'' refers to the final 16 bits of the address only, otherwise it
refers to the remaining unspecified bits of the address.
 </p>
 <p>
  The wildcard ``*'' refers to all users, groups or host addresses,
including ``"unix:"''.
Names of users, groups or hosts may not be wildcarded.
 </p>
 <p>
  The following are all valid host identifiers:
 </p>
 <p>
 </p>
 <pre>
boing
localhost
giggle.melbourne.sgi.com
129.127.112.2
129.127.114.*
129.*
.*
fe80::223:14ff:feaf:b62c
fe80::223:14ff:feaf:*
fe80:*
:*
"unix:"
"local:"
*

</pre>
 <p>
  The following are not valid host identifiers:
 </p>
 <p>
 </p>
 <pre>
*.melbourne
129.127.*.*
129.*.114.9
129.127*
fe80::223:14ff:*:*
fe80::223:14ff:*:b62c
fe80*

</pre>
 <p>
  The first example is not allowed because only (numeric) IP addresses may
contain a wildcard.
The second and fifth examples are not valid because there is more than
one wildcard character.
The third and sixth contain an embedded wildcard, the fourth and seventh
have a wildcard character that is not the last component of
the address (the last components are
  <tt>
   127*
  </tt>
  and
  <tt>
   fe80*
  </tt>
  respectively).
 </p>
 <p>
  The name
  <b>
   localhost
  </b>
  is given special treatment to make the behavior of host wildcarding
consistent.
Rather than being 127.0.0.1 and ::1, it is mapped to the primary inet and IPv6 addresses
associated with the name of the host on which
  <b>
   pmcd
  </b>
  is running.
Beware of this when running
  <b>
   pmcd
  </b>
  on multi-homed hosts.
 </p>
 <p>
  Access for users, groups or hosts are allowed or disallowed by specifying
statements of the form:
 </p>
 <dl compact="">
  <dt>
  </dt>
  <dd>
   <b>
    allow users
   </b>
   <i>
    userlist
   </i>
   <b>
    :
   </b>
   <i>
    operations
   </i>
   <b>
    ;
   </b>
   <br/>
   <b>
    disallow users
   </b>
   <i>
    userlist
   </i>
   <b>
    :
   </b>
   <i>
    operations
   </i>
   <b>
    ;
   </b>
   <br/>
   <b>
    allow groups
   </b>
   <i>
    grouplist
   </i>
   <b>
    :
   </b>
   <i>
    operations
   </i>
   <b>
    ;
   </b>
   <br/>
   <b>
    disallow groups
   </b>
   <i>
    grouplist
   </i>
   <b>
    :
   </b>
   <i>
    operations
   </i>
   <b>
    ;
   </b>
   <br/>
   <b>
    allow hosts
   </b>
   <i>
    hostlist
   </i>
   <b>
    :
   </b>
   <i>
    operations
   </i>
   <b>
    ;
   </b>
   <br/>
   <b>
    disallow hosts
   </b>
   <i>
    hostlist
   </i>
   <b>
    :
   </b>
   <i>
    operations
   </i>
   <b>
    ;
   </b>
  </dd>
  <dt>
   <i>
    list
   </i>
  </dt>
  <dd>
   <i>
    userlist
   </i>
   ,
   <i>
    grouplist
   </i>
   and
   <i>
    hostlist
   </i>
   are comma separated lists of one or more users, groups or host identifiers.
  </dd>
  <dt>
   <i>
    operations
   </i>
  </dt>
  <dd>
   is a comma separated list of the operation types described above,
   <b>
    all
   </b>
   (which allows/disallows all operations), or
   <b>
    all except
   </b>
   <i>
    operations
   </i>
   (which allows/disallows all operations except those listed).
  </dd>
 </dl>
 <p>
  Either plural or singular forms of
  <b>
   users
  </b>
  ,
  <b>
   groups
  </b>
  ,

and
  <b>
   hosts
  </b>
  keywords are allowed.
If this keyword is omitted, a default of
  <b>
   hosts
  </b>
  will be used.
This behaviour is for backward-compatibility only, it is preferable to be explicit.
 </p>
 <p>
  Where no specific
  <b>
   allow
  </b>
  or
  <b>
   disallow
  </b>
  statement applies to an operation, the default is to allow the
operation from all users, groups and hosts.
In the trivial case when there is no access control section in
the configuration file, all operations from all users, groups,
and hosts are permitted.
 </p>
 <p>
  If a new connection to
  <b>
   pmcd
  </b>
  is attempted by a user, group or host that is not permitted to perform any
operations, the connection will be closed immediately after an error response
  <b>
   PM_ERR_PERMISSION
  </b>
  has been sent to the client attempting the connection.
 </p>
 <p>
  Statements with the same level of wildcarding specifying identical hosts may
not contradict each other.
For example if a host named
  <b>
   clank
  </b>
  had an IP address of 129.127.112.2, specifying the following two rules would be
erroneous:
 </p>
 <p>
 </p>
 <pre>
allow host clank : fetch, store;
disallow host 129.127.112.2 : all except fetch;

</pre>
 <p>
  because they both refer to the same host, but disagree as to whether the
  <b>
   fetch
  </b>
  operation is permitted from that host.
 </p>
 <p>
  Statements containing more specific host specifications override less specific
ones according to the level of wildcarding.
For example a rule of the form
 </p>
 <p>
 </p>
 <pre>
allow host clank : all;

</pre>
 <p>
  overrides
 </p>
 <p>
 </p>
 <pre>
disallow host 129.127.112.* : all except fetch;

</pre>
 <p>
  because the former contains a specific host name (equivalent to a fully
specified IP address), whereas the latter has a wildcard.
In turn, the latter would override
 </p>
 <p>
 </p>
 <pre>
disallow host * : all;

</pre>
 <p>
  It is possible to limit the number of connections from a user, group or host to
  <b>
   pmcd
  </b>
  .

This may be done by adding a clause of the form
 </p>
 <dl compact="">
  <dt>
  </dt>
  <dd>
   <b>
    maximum
   </b>
   <i>
    n
   </i>
   <b>
    connections
   </b>
  </dd>
 </dl>
 <p>
  to the
  <i>
   operations
  </i>
  list of an
  <b>
   allow
  </b>
  statement.
Such a clause may not be used in a
  <b>
   disallow
  </b>
  statement.
Here,
  <i>
   n
  </i>
  is the maximum number of connections that will be accepted from the user, group
or host matching the identifier(s) used in the statement.
 </p>
 <p>
  An access control statement with a list of user, group or host identifiers is
equivalent to a set of access control statements, with each specifying one of
the identifiers in the list and all with the same access controls (both permissions
and connection limits).
A group should be used if you want users to contribute to a shared connection limit.
A wildcard should be used if you want hosts to contribute to a shared connection limit.
 </p>
 <p>
  When a
new client requests a connection, and
  <b>
   pmcd
  </b>
  has determined that the client has permission to connect, it searches the
matching list of access control statements for the most specific match
containing a connection limit.
For brevity, this will be called the limiting
statement.
If there is no limiting statement, the client is granted a
connection.
If there is a limiting statement and the number of
  <b>
   pmcd
  </b>
  clients with user ID, group ID, or IP addresses that match the identifier in
the limiting statement is less than the connection limit in the statement,
the connection is allowed.
Otherwise the connection limit has been reached and the client is
refused a connection.
 </p>
 <p>
  Group access controls and the wildcarding in host identifiers means that once
  <b>
   pmcd
  </b>
  actually accepts a connection from a client, the connection may contribute to
the current connection count of more than one access control statement - the
client's host may match more than one access control statement, and similarly
the user ID may be in more than one group.
This may be significant for subsequent connection requests.
 </p>
 <p>
  Note that
  <b>
   pmcd
  </b>
  enters a mode where it runs effectively with a higher-level of security as
soon as a user or group access control section is added to the configuration.
In this mode only authenticated connections are allowed - either from a SASL
authenticated connection, or a Unix domain socket (which implicitly passes
client credentials).
This is the same mode that is entered explicitly using the
  <b>
   -S
  </b>
  option.
Assuming permission is allowed, one can determine whether
  <b>
   pmcd
  </b>
  is running in this mode by querying the value of the
  <i>
   pmcd.feature.creds_required
  </i>
  metric.
 </p>
 <p>
  Note also that because most specific match semantics are used when checking the
connection limit, for the host-based access control case, priority is given
to clients with more specific host identifiers.
It is also possible to exceed connection limits in some situations.
Consider the following:
 </p>
 <dl compact="">
  <dt>
  </dt>
  <dd>
   allow host clank : all, maximum 5 connections;
   <br/>
   allow host * : all except store, maximum 2 connections;
  </dd>
 </dl>
 <p>
  This says that only 2 client connections at a time are permitted for all
hosts other than "clank", which is permitted 5.
If a client from host "boing" is the first to connect to
  <b>
   pmcd
  </b>
  ,

its connection is checked against the second statement (that is the most
specific match with a connection limit).
As there are no other clients, the
connection is accepted and contributes towards the limit for only the second
statement above.
If the next client connects from "clank", its connection is
checked against the limit for the first statement.
There are no other
connections from "clank", so the connection is accepted.
Once this connection
is accepted, it counts towards
  <b>
   both
  </b>
  statements' limits because "clank" matches the host identifier in both
statements.
Remember that the decision to accept a new connection is made
using only the most specific matching access control statement with a
connection limit.
Now, the connection limit for the second statement has been
reached.
Any connections from hosts other than "clank" will be refused.
 </p>
 <p>
  If instead,
  <b>
   pmcd
  </b>
  with no clients saw three successive connections arrived from "boing", the
first two would be accepted and the third refused.
After that, if a connection
was requested from "clank" it would be accepted.
It matches the first
statement, which is more specific than the second, so the connection limit in
the first is used to determine that the client has the right to connect.
Now
there are 3 connections contributing to the second statement's connection
limit.
Even though the connection limit for the second statement has been
exceeded, the earlier connections from "boing" are maintained.
The connection
limit is only checked at the time a client attempts a connection rather than
being re-evaluated every time a new client connects to
  <b>
   pmcd
  </b>
  .
 </p>
 <p>
  This gentle scheme is designed to allow reasonable limits to be imposed
on a first come first served basis, with specific exceptions.
 </p>
 <p>
  As illustrated by the example above, a client's connection is honored once it
has been accepted.
However,
  <b>
   pmcd
  </b>
  reconfiguration (see the next section) re-evaluates all the connection counts
and will cause client connections to be dropped where connection limits have
been exceeded.
  <a name="lbAI">
  </a>
 </p>
 <h2>
  AGENT FENCING
 </h2>
 Preventing sampling during the life of a PMDA is sometimes desirable, for
example if that sampling impacts on sensitive phases of a scheduled job.
A temporary ``fence'' can be raised to block all PMAPI client access to
one or more agents in this situation.
This functionality is provided by the built-in PMCD PMDA and the
 <b>
  <a href="/man/man1/pmstore.1.html">
   pmstore
  </a>
 </b>
 (1)

command, as in
 <p>
 </p>
 <pre>
# pmstore -i nfsclient,kvm pmcd.agent.fenced 1

</pre>
 <p>
  If the optional comma-separated list of agent names is omitted, all agents
will be fenced.
To resume normal operation, the ``fence'' can be lowered as follows
 </p>
 <p>
 </p>
 <pre>
# pmstore -i nfsclient,kvm pmcd.agent.fenced 0

</pre>
 <p>
  Lowering the fence for all PMDAs at once is performed using
 </p>
 <p>
 </p>
 <pre>
# pmstore pmcd.agent.fenced 0

</pre>
 <p>
  Elevated privileges are required to store to the
  <i>
   pmcd.agent.fenced
  </i>
  metric.
For additional information, see the help text associated with this metric,
which can be accessed using the
  <i>
   -T
  </i>
  <b>
   , --helptext
  </b>
  option to
  <b>
   <a href="/man/man1/pminfo.1.html">
    pminfo
   </a>
  </b>
  (1).
  <a name="lbAJ">
  </a>
 </p>
 <h2>
  RECONFIGURING PMCD
 </h2>
 If the configuration file has been changed or if an agent is not responding
because it has terminated or the PMNS has been changed,
 <b>
  pmcd
 </b>
 may be reconfigured by sending it a SIGHUP, as in
 <p>
 </p>
 <pre>
# pmsignal -a -s HUP pmcd

</pre>
 <p>
  When
  <b>
   pmcd
  </b>
  receives a SIGHUP, it checks the configuration file for changes.
If the file
has been modified, it is reparsed and the contents become the new
configuration.
If there are errors in the configuration file, the existing
configuration is retained and the contents of the file are ignored.
Errors are reported in the
  <b>
   pmcd
  </b>
  log file.
 </p>
 <p>
  It also checks the PMNS file and any labels files for changes.
If any of these files have been modified, then the PMNS and/or
context labels are reloaded.
Use of
  <b>
   <a href="http://man7.org/linux/man-pages/man1/tail.1.html">
    tail
   </a>
  </b>
  (1)

on the log file is recommended while reconfiguring
  <b>
   pmcd
  </b>
  .
 </p>
 <p>
  If the configuration for an agent has changed (any parameter except the agent's
label is different), the agent is restarted.
Agents whose configurations do not change are not
restarted.
Any existing agents
not present in the new configuration are terminated.
Any deceased agents are that are still listed are
restarted.
 </p>
 <p>
  Sometimes it is necessary to restart an agent that is still running, but
malfunctioning.
Simply stop the agent (e.g. using SIGTERM from
  <b>
   <a href="/man/man1/pmsignal.1.html">
    pmsignal
   </a>
  </b>
  (1)),

then send
  <b>
   pmcd
  </b>
  a SIGHUP, which will cause the agent to be restarted.
  <a name="lbAK">
  </a>
 </p>
 <h2>
  STARTING AND STOPPING PMCD
 </h2>
 Normally,
 <b>
  pmcd
 </b>
 is started automatically at boot time and stopped when the
system is being brought down.
Under certain circumstances it is necessary to start or stop
 <b>
  pmcd
 </b>
 manually.
To do this one must become superuser and type
 <p>
 </p>
 <pre>
# $PCP_RC_DIR/pmcd start

</pre>
 <p>
  to start
  <b>
   pmcd
  </b>
  ,

or
 </p>
 <p>
 </p>
 <pre>
# $PCP_RC_DIR/pmcd stop

</pre>
 <p>
  to stop
  <b>
   pmcd
  </b>
  .

Starting
  <b>
   pmcd
  </b>
  when it is already running is the same as stopping
it and then starting it again.
 </p>
 <p>
  Sometimes it may be necessary to restart
  <b>
   pmcd
  </b>
  during another phase of the boot process.
Time-consuming parts of the boot
process are often put into the background to allow the system to become
available sooner (e.g. mounting huge databases).
If an agent run by
  <b>
   pmcd
  </b>
  requires such a task to complete before it can run properly, it is necessary to
restart or reconfigure
  <b>
   pmcd
  </b>
  after the task completes.
Consider, for example, the case of mounting a
database in the background while booting.
If the PMDA which provides the
metrics about the database cannot function until the database is mounted and
available but
  <b>
   pmcd
  </b>
  is started before the database is ready, the PMDA will fail (however
  <b>
   pmcd
  </b>
  will still service requests for metrics from other domains).
If the database
is initialized by running a shell script, adding a line to the end of the
script to reconfigure
  <b>
   pmcd
  </b>
  (by sending it a SIGHUP) will restart the PMDA (if it exited because it
couldn't connect to the database).
If the PMDA didn't exit in such a situation
it would be necessary to restart
  <b>
   pmcd
  </b>
  because if the PMDA was still running
  <b>
   pmcd
  </b>
  would not restart it.
 </p>
 <p>
  Normally
  <b>
   pmcd
  </b>
  listens for client connections on TCP/IP port number 44321
(registered at
  <b>
   <a href="http://www.iana.org/">
    http://www.iana.org/
   </a>
  </b>
  ).

Either the environment
variable
  <b>
   PMCD_PORT
  </b>
  or the
  <b>
   -p
  </b>
  command line option
may be used to specify alternative port number(s) when
  <b>
   pmcd
  </b>
  is started; in each case, the specification is a comma-separated list
of one or more numerical port numbers.
Should both methods be used or multiple
  <b>
   -p
  </b>
  options appear on the command line,
  <b>
   pmcd
  </b>
  will listen on the union of the set of ports specified via all
  <b>
   -p
  </b>
  options and the
  <b>
   PMCD_PORT
  </b>
  environment variable.
If non-default ports are used with
  <b>
   pmcd
  </b>
  care should be taken to ensure that
  <b>
   PMCD_PORT
  </b>
  is also set in the environment of any client application that
will connect to
  <b>
   pmcd
  </b>
  ,

or that the extended host specification syntax is used
(see
  <b>
   <a href="/man/man1/pcpintro.1.html">
    PCPIntro
   </a>
  </b>
  (1)

for details).
  <a name="lbAL">
  </a>
 </p>
 <h2>
  CAVEATS
 </h2>
 <b>
  pmcd
 </b>
 does not explicitly terminate its children (agents), it only
closes their pipes.
If an agent never checks for a closed pipe it may not terminate.
 <p>
  The configuration file parser will only read lines of less than 1200
characters.
This is intended to prevent accidents with binary files.
 </p>
 <p>
  The timeouts controlled by the
  <b>
   -t
  </b>
  option apply to IPC between
  <b>
   pmcd
  </b>
  and the PMDAs it spawns.
This is independent of settings of the environment variables
  <b>
   PMCD_CONNECT_TIMEOUT
  </b>
  and
  <b>
   PMCD_REQUEST_TIMEOUT
  </b>
  (see
  <b>
   <a href="/man/man1/pcpintro.1.html">
    PCPIntro
   </a>
  </b>
  (1))

which may be used respectively to control timeouts for client applications
trying to connect to
  <b>
   pmcd
  </b>
  and trying to receive information from
  <b>
   pmcd
  </b>
  .
  <a name="lbAM">
  </a>
 </p>
 <h2>
  DIAGNOSTICS
 </h2>
 If
 <b>
  pmcd
 </b>
 is already running the message "Error: OpenRequestSocket bind: Address may already be in use" will appear.
This may also appear if
 <b>
  pmcd
 </b>
 was shutdown with an outstanding request from a client.
In this case, a
request socket has been left in the TIME_WAIT state and until the system closes
it down (after some timeout period) it will not be possible to run
 <b>
  pmcd
 </b>
 .
 <p>
  In addition to the standard
  <b>
   PCP
  </b>
  debugging flags, see
  <b>
   <a href="/man/man1/pmdbg.1.html">
    pmdbg
   </a>
  </b>
  (1),
  <b>
   pmcd
  </b>
  currently uses the options:
  <b>
   appl0
  </b>
  for tracing I/O and termination of agents,
  <b>
   appl1
  </b>
  for tracing access control and
  <b>
   appl2
  </b>
  for tracing the configuration file scanner and parser.
  <a name="lbAN">
  </a>
 </p>
 <h2>
  FILES
 </h2>
 <dl compact="">
  <dt>
   <i>
    $PCP_PMCDCONF_PATH
   </i>
  </dt>
  <dd>
   default configuration file
  </dd>
  <dt>
   <i>
    $PCP_PMCDCONF_PATH.access
   </i>
  </dt>
  <dd>
   optional access control specification file
  </dd>
  <dt>
   <i>
    $PCP_PMCDOPTIONS_PATH
   </i>
  </dt>
  <dd>
   command line options to
   <b>
    pmcd
   </b>
   when launched from
   <i>
    $PCP_RC_DIR/pmcd
   </i>
   All the command line option lines should start with a hyphen as
the first character.
  </dd>
  <dt>
   <i>
    $PCP_SYSCONFIG_DIR/pmcd
   </i>
  </dt>
  <dd>
   additional environment variables that will be set when
   <b>
    pmcd
   </b>
   executes.
Only settings of the form "PMCD_VARIABLE=value" will be honoured.
  </dd>
  <dt>
   <i>
    $PCP_SYSCONF_DIR/labels
   </i>
  </dt>
  <dd>
   directory of files containing the global metric labels that will be
set for every client context created by
   <b>
    pmcd
   </b>
   .

File names starting with a ``.'' are ignored, and files ending in
``.json'' are ``JSONB'' formatted name:value pairs.
The merged set can be queried via the
   <b>
    pmcd.labels
   </b>
   metric.
Context labels are applied universally to all values.
  </dd>
  <dt>
   <i>
    ./pmcd.log
   </i>
  </dt>
  <dd>
   (or
   <i>
    $PCP_LOG_DIR/pmcd/pmcd.log
   </i>
   when started automatically)
   <br/>
   All messages and diagnostics are directed here.
  </dd>
  <dt>
   <i>
    $PCP_RUN_DIR/pmcd.pid
   </i>
  </dt>
  <dd>
   contains an ascii decimal representation of the process ID of
   <b>
    pmcd
   </b>
   ,

when it's running.
  </dd>
  <dt>
   <i>
    /etc/pki/nssdb
   </i>
  </dt>
  <dd>
   default Network Security Services (NSS) certificate database
directory, used for optional Secure Socket Layer connections.
This database can be created and queried using the NSS
   <b>
    certutil
   </b>
   tool, amongst others.
  </dd>
  <dt>
   <i>
    /etc/passwd
   </i>
  </dt>
  <dd>
   user names, user identifiers and primary group identifiers, used for access control specifications
  </dd>
  <dt>
   <i>
    /etc/groups
   </i>
  </dt>
  <dd>
   group names, group identifiers and group members, used for access control specifications
  </dd>
 </dl>
 <a name="lbAO">
 </a>
 <h2>
  ENVIRONMENT
 </h2>
 The following variables are set in
 <b>
  $PCP_SYSCONFIG_DIR/pmcd
 </b>
 <i>
  .
 </i>
 <p>
  In addition to the PCP environment variables described in the
  <b>
   PCP ENVIRONMENT
  </b>
  section below, the
  <b>
   PMCD_PORT
  </b>
  variable is also recognised
as the TCP/IP port for incoming connections
(default
  <i>
   44321
  </i>
  ),

and the
  <b>
   PMCD_SOCKET
  </b>
  variable is also recognised
as the path to be used for the Unix domain socket.
 </p>
 <p>
  If set to the value 1, the
  <b>
   PMCD_LOCAL
  </b>
  environment variable will cause
  <b>
   pmcd
  </b>
  to run in a localhost-only mode of operation, where it binds only
to the loopback interface.
The
  <i>
   pmcd.feature.local
  </i>
  metric can be queried to determine if
  <b>
   pmcd
  </b>
  is running in this mode.
 </p>
 <p>
  The
  <b>
   PMCD_MAXPENDING
  </b>
  variable can be set to indicate the maximum length to which the queue
of pending client connections may grow.
 </p>
 <p>
  The
  <b>
   PMCD_ROOT_AGENT
  </b>
  variable controls whether or not
  <b>
   pmcd
  </b>
  or
  <b>
   pmdaroot
  </b>
  (when available), start subsequent pmdas.
When set to a non-zero value,
  <b>
   pmcd
  </b>
  will opt to have
  <b>
   pmdaroot
  </b>
  start, and stop, PMDAs.
 </p>
 <p>
  The
  <b>
   PMCD_RESTART_AGENTS
  </b>
  variable determines the behaviour of
  <b>
   pmcd
  </b>
  in the presence of child PMDAs that have been observed to exit (this is a
typical response in the presence of very large, usually domain-induced,
PDU latencies).
When set to a non-zero value,
  <b>
   pmcd
  </b>
  will attempt to restart such PMDAS once every minute.
When set to zero, it uses the original behaviour of just logging the failure.
  <a name="lbAP">
  </a>
 </p>
 <h2>
  PCP ENVIRONMENT
 </h2>
 Environment variables with the prefix
 <b>
  PCP_
 </b>
 are used to parameterize
the file and directory names used by PCP.
On each installation, the
file
 <i>
  /etc/pcp.conf
 </i>
 contains the local values for these variables.
The
 <b>
  $PCP_CONF
 </b>
 variable may be used to specify an alternative
configuration file, as described in
 <b>
  <a href="/man/man5/pcp.conf.5.html">
   pcp.conf
  </a>
 </b>
 (5).
 <p>
  For environment variables affecting PCP tools, see
  <b>
   <a href="/man/man3/pmgetoptions.3.html">
    pmGetOptions
   </a>
  </b>
  (3).
  <a name="lbAQ">
  </a>
 </p>
 <h2>
  SEE ALSO
 </h2>
 <b>
  <a href="/man/man1/pcpintro.1.html">
   PCPIntro
  </a>
 </b>
 (1),
 <b>
  <a href="/man/man1/pmdbg.1.html">
   pmdbg
  </a>
 </b>
 (1),
 <b>
  <a href="/man/man1/pmerr.1.html">
   pmerr
  </a>
 </b>
 (1),
 <b>
  <a href="/man/man1/pmgenmap.1.html">
   pmgenmap
  </a>
 </b>
 (1),
 <b>
  <a href="/man/man1/pminfo.1.html">
   pminfo
  </a>
 </b>
 (1),
 <b>
  <a href="/man/man1/pmrep.1.html">
   pmrep
  </a>
 </b>
 (1),
 <b>
  <a href="/man/man1/pmstat.1.html">
   pmstat
  </a>
 </b>
 (1),
 <b>
  <a href="/man/man1/pmstore.1.html">
   pmstore
  </a>
 </b>
 (1),
 <b>
  <a href="/man/man1/pmval.1.html">
   pmval
  </a>
 </b>
 (1),
 <b>
  <a href="http://man7.org/linux/man-pages/man3/getpwent.3.html">
   getpwent
  </a>
 </b>
 (3),
 <b>
  <a href="http://man7.org/linux/man-pages/man3/getgrent.3.html">
   getgrent
  </a>
 </b>
 (3),
 <b>
  <a href="/man/man5/pcp.conf.5.html">
   pcp.conf
  </a>
 </b>
 (5),
 <b>
  <a href="/man/man5/pcp.env.5.html">
   pcp.env
  </a>
 </b>
 (5)

and
 <b>
  <a href="/man/man5/pmns.5.html">
   PMNS
  </a>
 </b>
 (5).
 <p>
 </p>
 <hr/>
 <a name="index">
 </a>
 <h2>
  Index
 </h2>
 <dl>
  <dt>
   <a href="#lbAB">
    NAME
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAC">
    SYNOPSIS
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAD">
    DESCRIPTION
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAE">
    OPTIONS
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAF">
    CONFIGURATION
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAG">
    AGENT CONFIGURATION
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAH">
    ACCESS CONTROL CONFIGURATION
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAI">
    AGENT FENCING
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAJ">
    RECONFIGURING PMCD
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAK">
    STARTING AND STOPPING PMCD
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAL">
    CAVEATS
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAM">
    DIAGNOSTICS
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAN">
    FILES
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAO">
    ENVIRONMENT
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAP">
    PCP ENVIRONMENT
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAQ">
    SEE ALSO
   </a>
  </dt>
  <dd>
  </dd>
 </dl>
 
</div>
</div>
</div>
</div>
</div>
<footer class='global-footer is-typeset'>
<div class='row-parent'>
<div class='row'>
<section class='row__colspaced'>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>Main Menu</h4>
<ul>
<li>
<a href='/features.html'>Features</a>
</li>
<li>
<a href='/documentation.html'>Documentation</a>
</li>
<li>
<a class='download' href='/download.html'>Download</a>
</li>
</ul>
</div>
</div>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>Developers</h4>
<ul>
<li>
<a href='https://github.com/performancecopilot/pcp/issues'>Report an issue</a>
</li>
<li>
<a href='https://github.com/performancecopilot/pcp/projects/1'>Roadmap</a>
</li>
<li>
<a href='/community.html'>Contributing</a>
</li>
<li>
<a href='/team.html'>Team</a>
</li>
</ul>
</div>
</div>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>About</h4>
<ul>
<li>
<a href='/testimonials.html'>Testimonials</a>
</li>
<li>
<a href='/faq.html'>FAQ</a>
</li>
<li>
<a href='/website.html'>Website</a>
</li>
</ul>
</div>
</div>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>Get Social</h4>
<ul>
<li>
<a class='twitter' href='https://twitter.com/performancepcp' rel='external'>Twitter</a>
</li>
<li>
<a class='github' href='https://github.com/performancecopilot' rel='external'>Github</a>
</li>
</ul>
</div>
</div>
</section>
</div>
<div class='row'>
<div class='colspan2-2'>
<p class='legal'>
This website is Copyright &copy; 2000-2004 Silicon Graphics Inc, 2007-2010 Aconex, 2012-2019 Red Hat
</p>
</div>
</div>
</div>
</footer>

</body>
</html>
