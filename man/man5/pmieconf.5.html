<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='initial-scale=1' name='viewport'>
<title>Performance Co-Pilot</title>
<link href='/assets/css/screen.css' media='all' rel='stylesheet' type='text/css'>
<link href='/assets/css/master.css' media='all' rel='stylesheet' type='text/css'>
<link href='/images/pcp.ico' rel='shortcut icon' type='image/ico'>

</head>
<body>
<header class='global-header'>
<div class='row'>
<h1 class='global-logo colspan12-6 colspan8-4 colspan6-3 colspan2-1 as-grid'>
<a href='/index.html'>Performance Co-Pilot</a>
</h1>
<nav class='global-header__navigation colspan12-6 colspan8-6 colspan6-4 colspan2-1 as-grid'>
<ul>
<li>
<a href='/features.html'>Features</a>
</li>
<li>
<a href='/documentation.html'>Documentation</a>
</li>
<li>
<a href='/download.html'>Download</a>
</li>
<li>
<a href='/community.html'>Get Involved</a>
</li>
</ul>
</nav>
</div>
</header>

<div class='site-content'>
<div class='how-to is-typeset'>
<div class='row-parent'>
<div class='row'>
<div class='manpage'>
ï»¿
 <h1>
  PMIECONF
 </h1>
 Section: File Formats (5)
 <br/>
 <a href="#index">
  Index
 </a>
 <a href="/man">
  Return to Main Contents
 </a>
 <hr/>
 <a name="lbAB">
 </a>
 <h2>
  NAME
 </h2>
 pmieconf - generalized pmie rules and customizations
 <a name="lbAC">
 </a>
 <h2>
  DESCRIPTION
 </h2>
 The pmieconf file formats are used by the
 <b>
  <a href="/man/man1/pmieconf.1.html">
   pmieconf
  </a>
 </b>
 (1)

tool as a way to generalize
 <b>
  <a href="/man/man1/pmie.1.html">
   pmie
  </a>
 </b>
 (1)

rule sets such that they can be easily configured for different systems and
different environments.
There are two completely different (although closely related) file formats
discussed here, namely ``pmieconf-rules'' and ``pmieconf-pmie''.
 <p>
  The directory
  <b>
   $PCP_VAR_DIR/config/pmieconf
  </b>
  contains information about all the default system
  <b>
   pmie
  </b>
  generalized rules and variables, including default values for all variables.
These files are in the pmieconf-rules format.
Although new pmieconf-rules files can be added, the files in this directory
should never be changed.
Instead, use the
  <b>
   pmieconf
  </b>
  utility to change variable values in the
  <b>
   pmie
  </b>
  configuration file.
 </p>
 <p>
  The pmieconf-pmie format allows site specific customizations of the rules
contained in pmieconf-rules files and their associated variables.
The pmieconf-pmie format is generated by
  <b>
   pmieconf
  </b>
  and should not be edited by hand.
This generated file is in the
  <b>
   pmie
  </b>
  format, with some additional information held at the head of the file - thus,
the pmieconf-pmie format is a superset of the
  <b>
   pmie
  </b>
  file format (extended to hold customizations to the generalized rules, but
also containing the actual performance rules for
  <b>
   pmie
  </b>
  to evaluate) which can also be parsed by
  <b>
   pmie
  </b>
  (all extensions are hidden within comments, and are thus meaningless to
  <b>
   pmie
  </b>
  itself).
 </p>
 <p>
  The file
  <b>
   $PCP_VAR_DIR/config/pmieconf/config.pmie
  </b>
  contains local system settings for
  <b>
   pmieconf
  </b>
  configurable variables.
The variable settings in this file replace the default values specified in
  <b>
   $PCP_VAR_DIR/config/pmieconf/*/*
  </b>
  .
  <a name="lbAD">
  </a>
 </p>
 <h2>
  PMIECONF-PMIE SYNTAX
 </h2>
 All rule customization lines in a valid pmieconf-pmie specification
are prefixed by ``//'' and are located at the head of the file -
this allows files containing a pmieconf-pmie specification to be
successfully parsed by
 <b>
  pmie
 </b>
 .

A pmieconf-pmie must always have the first line in the form:
 <p>
 </p>
 <pre>
    // pmieconf-pmie <i>version</i> <i>pmieconf_path</i>
</pre>
 <p>
  The
  <i>
   version
  </i>
  specifies which version of the pmieconf-pmie syntax should be used to
parse this file.
Currently the only supported version is 1.  The
  <i>
   pmieconf_path
  </i>
  specifies the path to the pmieconf-rules files which were used, by
  <b>
   pmieconf
  </b>
  ,

to generate this file.  This is discussed in the
  <b>
   <a href="/man/man1/pmieconf.1.html">
    pmieconf
   </a>
  </b>
  (1)

man page (see the
  <b>
   -r
  </b>
  option).
 </p>
 <p>
  The remainder of the specification consists of one line entries for each
of the modified variables.  The syntax for each line is:
 </p>
 <p>
 </p>
 <pre>
    // <i>rule_version</i> <i>rule_name</i> <i>rule_variable</i> = <i>value</i>
</pre>
 <p>
  The
  <i>
   rule_version
  </i>
  and
  <i>
   rule_name
  </i>
  are used to identify the rule with which to associate the customization.
These are followed by the
  <i>
   rule_variable
  </i>
  name (i.e. the variable of rule
  <i>
   rule_name
  </i>
  which has been changed)
for which the new
  <i>
   value
  </i>
  is to be used.
 </p>
 <p>
  A pmieconf-pmie specification must be terminated with the ``end'' keyword.
This is used by
  <b>
   pmieconf
  </b>
  to distinguish where the customizations ends, and the actual
  <b>
   pmie
  </b>
  rule component begins.
  <a name="lbAE">
  </a>
 </p>
 <h2>
  PMIECONF-PMIE EXAMPLE
 </h2>
 The following example is a valid pmieconf-pmie format file, as generated by
 <b>
  pmieconf
 </b>
 .

In order to make changes by hand which are preserved by
 <b>
  pmieconf
 </b>
 ,

see the comments contained in the generated file (below) as to where such
changes should be made.
 <p>
 </p>
 <pre>
    // pmieconf-pmie 1 $PCP_VAR_DIR/config/pmieconf
    // 1 memory.exhausted delta = "4 minutes"
    // 1 memory.exhausted enabled = yes
    // 1 memory.exhausted pcplog_action = yes
    // end
    //
    // --- START GENERATED SECTION (do not change this section) ---
    //     generated by pmieconf on:  [DATESTAMP]
    //

    // 1 memory.exhausted
    delta = 4 minutes;
    some_host (
        ( avg_sample (swap.pagesout @0..9 ) ) &gt; 0 &amp;&amp;
        30 %_sample swap.pagesout &gt;= 5
    ) -&gt; shell 10 min "$PCP_BINADM_DIR/pmpost Severe demand for real memory" \
            " %vpgsout/s@%h";

    // --- END GENERATED SECTION (changes below will be preserved) ---
</pre>
 <p>
 </p>
 <p>
  To see how this all works, you can generate this file as follows:
 </p>
 <p>
 </p>
 <pre>
    # cat - | pmieconf -f /tmp/pmieconf.out \
        -r $PCP_VAR_DIR/config/pmieconf/memory:$PCP_VAR_DIR/config/pmieconf/global
    modify memory.exhausted delta "4 minutes"
    modify memory.exhausted enabled yes
    modify memory.exhausted pcplog_action yes
    ^D
    #
</pre>
 <p>
  Then verify that the generated file is a valid
  <b>
   pmie
  </b>
  configuration file using:
 </p>
 <p>
 </p>
 <pre>
    # pmie -C /tmp/pmieconf.out
</pre>
 <p>
  This parses the file, and then exits after reporting any syntax errors.
Now replace -C with -v (above), and watch
  <b>
   pmie
  </b>
  do its work!
  <a name="lbAF">
  </a>
 </p>
 <h2>
  PMIECONF-RULES SYNTAX
 </h2>
 A pmieconf-rules specification consists of a number of separate data objects
which together form a complete rule specification (note that a specification
may span multiple files and even multiple subdirectories).
Each object must have an
 <i>
  identifier
 </i>
 string and a data
 <i>
  type
 </i>
 ,

followed by an (optional) list of
 <i>
  attribute
 </i>
 s.
 <p>
  The generic specification of a pmieconf-rules object is thus:
 </p>
 <p>
 </p>
 <pre>
    <i>type</i> <i>identifier</i> [ <i>attribute</i> = <i>value</i> ]* ;
</pre>
 <p>
  The set of valid
  <i>
   type
  </i>
  s

is: "rule" (rule definition), "string" (arbitrary, double-quote enclosed
string), "double", "integer", "unsigned", "percent" (real number between 0
and 100), "hostlist" (space separated list of host names), "instlist" (space
separated list of metric instance names), and the four
  <b>
   pmie
  </b>
  action types, namely
"print", "shell", "alarm", and "syslog".
 </p>
 <p>
  Rule names use the ``.'' character to introduce the concept of a rule group,
e.g. "memory.exhausted" associates this rule with the "memory" group.
  <b>
   pmieconf
  </b>
  can operate at either the level of rule groups or individual rules.
The group name "global" is reserved and may not be used with any rule.
 </p>
 <p>
  Usually when an object is created it is associated with the current rule.
However, if an object's name is preceded by the reserved group name "global",
then that object is visible to all rules.
 </p>
 <p>
  The set of valid
  <i>
   attribute
  </i>
  s

is: "help" (descriptive text about this object), "modify" (
  <i>
   value
  </i>
  is
yes/no, flags whether
  <b>
   pmieconf
  </b>
  should allow changes), "enabled" (
  <i>
   value
  </i>
  is yes/no, flags whether this is
on or off - only meaningful for rules and actions), "display" (yes/no - flags
whether
  <b>
   pmieconf
  </b>
  should show this object), "default" (
  <i>
   value
  </i>
  determined by
  <i>
   type
  </i>
  , and
is the default value for this object), and specific to objects of rule type
are the "version", "predicate", and "enumerate" attributes.  "version" and
"predicate" are fairly self explanatory ("predicate" must equate to a valid
  <b>
   pmie
  </b>
  rule when expanded), but "enumerate" requires further discussion.
 </p>
 <p>
  The "enumerate" clause is useful when you wish to generate multiple, similar
  <b>
   pmie
  </b>
  rules from a single predicate.
This is most useful for rule definitions wishing to use the "some_inst"
clause in the
  <b>
   pmie
  </b>
  language across multiple hosts.
For a rule to use these together, it must be certain that the
instance list is the same on all of the monitored hosts.
This is rarely true, so the "enumerate" attribute allows us to generate
multiple rules, expanded over variables of either type "instlist" or "hostlist".
These variables make up the value for the "enumerate" attribute - which is
a space-separated list of "instlist" or "hostlist" variable names.
 </p>
 <p>
  Objects can be incorporated into other object definitions using the
$
  <i>
   identifier
  </i>
  $ syntax.  See the example later for more insight into
how this is useful.
 </p>
 <p>
  When
  <b>
   pmieconf
  </b>
  is generating the
  <b>
   pmie
  </b>
  configuration file, it looks at each enabled rule with N enabled
actions (where N &gt; 0) and expands the string:
 </p>
 <p>
 </p>
 <pre>
    // "version" <i>identifier</i>
    delta = $delta$;
    "predicate" -&gt; $threshold$ $action1$ &amp; ... &amp; $actionN$ ;
</pre>
 <p>
  The delta, threshold, and action variables are defined globally
(using the "global" keyword) for all rules, but can, of course,
be changed at the level of an individual rule or rule group.
  <a name="lbAG">
  </a>
 </p>
 <h2>
  PMIECONF-RULES EXAMPLE
 </h2>
 The following is an example of a single pmieconf-rules specification,
showing a number of different aspects of the language discussed above.
The example defines a rule ("memory.exhausted") and a string ("rule").
 <p>
 </p>
 <pre>
    rule    memory.exhausted
            default = "$rule$"
            predicate =
    "some_host (
        ( avg_sample (swap.pagesout $hosts$ @0..9 ) ) &gt; 0 &amp;&amp;
        $pct$ %_sample swap.pagesout $hosts$ @0..9 &gt;= $threshold$
    )"
            enabled = yes
            version = 1
            help    =
    "The system is swapping modified pages out of main memory to the
    swap partitions, and has been doing this on at least pct of the
    last 10 evaluations of this rule.
    There appears to be insufficient main memory to meet the resident
    demands of the current workload.";

    string  rule
            default = "Severe demand for real memory"
            modify  = no
            display = no;
</pre>
 <p>
  Note that for the above rule to be complete, "threshold" and "pct" would
also need to be defined - for the full expression of this rule, refer to
  <i>
   $PCP_VAR_DIR/config/pmieconf/memory/exhausted
  </i>
  .
 </p>
 <p>
  <a name="lbAH">
  </a>
 </p>
 <h2>
  FILES
 </h2>
 <dl compact="">
  <dt>
   <i>
    $PCP_VAR_DIR/config/pmieconf/
   </i>
   */*
  </dt>
  <dd>
   generalized system resource monitoring rules
  </dd>
  <dt>
   <i>
    $PCP_VAR_DIR/config/pmieconf/config.pmie
   </i>
  </dt>
  <dd>
   default super-user settings for system resource monitoring rules
  </dd>
  <dt>
   <i>
    $HOME/.pcp/pmie/config.pmie
   </i>
  </dt>
  <dd>
   default user settings for system resource monitoring rules
  </dd>
 </dl>
 <a name="lbAI">
 </a>
 <h2>
  SEE ALSO
 </h2>
 <b>
  <a href="/man/man1/pmie.1.html">
   pmie
  </a>
 </b>
 (1)

and
 <b>
  <a href="/man/man1/pmieconf.1.html">
   pmieconf
  </a>
 </b>
 (1).
 <p>
 </p>
 <hr/>
 <a name="index">
 </a>
 <h2>
  Index
 </h2>
 <dl>
  <dt>
   <a href="#lbAB">
    NAME
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAC">
    DESCRIPTION
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAD">
    PMIECONF-PMIE SYNTAX
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAE">
    PMIECONF-PMIE EXAMPLE
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAF">
    PMIECONF-RULES SYNTAX
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAG">
    PMIECONF-RULES EXAMPLE
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAH">
    FILES
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAI">
    SEE ALSO
   </a>
  </dt>
  <dd>
  </dd>
 </dl>
 
</div>
</div>
</div>
</div>
</div>
<footer class='global-footer is-typeset'>
<div class='row-parent'>
<div class='row'>
<section class='row__colspaced'>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>Main Menu</h4>
<ul>
<li>
<a href='/features.html'>Features</a>
</li>
<li>
<a href='/documentation.html'>Documentation</a>
</li>
<li>
<a class='download' href='/download.html'>Download</a>
</li>
</ul>
</div>
</div>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>Developers</h4>
<ul>
<li>
<a href='https://github.com/performancecopilot/pcp/issues'>Report an issue</a>
</li>
<li>
<a href='https://github.com/performancecopilot/pcp/projects/1'>Roadmap</a>
</li>
<li>
<a href='/community.html'>Contributing</a>
</li>
<li>
<a href='/team.html'>Team</a>
</li>
</ul>
</div>
</div>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>About</h4>
<ul>
<li>
<a href='/testimonials.html'>Testimonials</a>
</li>
<li>
<a href='/faq.html'>FAQ</a>
</li>
<li>
<a href='/website.html'>Website</a>
</li>
</ul>
</div>
</div>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>Get Social</h4>
<ul>
<li>
<a class='twitter' href='https://twitter.com/performancepcp' rel='external'>Twitter</a>
</li>
<li>
<a class='github' href='https://github.com/performancecopilot' rel='external'>Github</a>
</li>
</ul>
</div>
</div>
</section>
</div>
<div class='row'>
<div class='colspan2-2'>
<p class='legal'>
This website is Copyright &copy; 2000-2004 Silicon Graphics Inc, 2007-2010 Aconex, 2012-2019 Red Hat
</p>
</div>
</div>
</div>
</footer>

</body>
</html>
