<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='initial-scale=1' name='viewport'>
<title>Performance Co-Pilot</title>
<link href='/assets/css/screen.css' media='all' rel='stylesheet' type='text/css'>
<link href='/assets/css/master.css' media='all' rel='stylesheet' type='text/css'>
<link href='/images/pcp.ico' rel='shortcut icon' type='image/ico'>

</head>
<body>
<header class='global-header'>
<div class='row'>
<h1 class='global-logo colspan12-6 colspan8-4 colspan6-3 colspan2-1 as-grid'>
<a href='/index.html'>Performance Co-Pilot</a>
</h1>
<nav class='global-header__navigation colspan12-6 colspan8-6 colspan6-4 colspan2-1 as-grid'>
<ul>
<li>
<a href='/features.html'>Features</a>
</li>
<li>
<a href='/documentation.html'>Documentation</a>
</li>
<li>
<a href='/download.html'>Download</a>
</li>
<li>
<a href='/community.html'>Get Involved</a>
</li>
</ul>
</nav>
</div>
</header>

<div class='site-content'>
<div class='how-to is-typeset'>
<div class='row-parent'>
<div class='row'>
<div class='manpage'>
﻿
 <h1>
  PMDAEVENTARRAY
 </h1>
 Section: C Library Functions (3)
 <br/>
 <a href="#index">
  Index
 </a>
 <a href="/man">
  Return to Main Contents
 </a>
 <hr/>
 <a name="lbAB">
 </a>
 <h2>
  NAME
 </h2>
 <b>
  pmdaEventNewArray
 </b>
 ,
 <b>
  pmdaEventResetArray
 </b>
 ,
 <b>
  pmdaEventReleaseArray
 </b>
 ,
 <b>
  pmdaEventAddRecord
 </b>
 ,
 <b>
  pmdaEventAddMissedRecord
 </b>
 ,
 <b>
  pmdaEventAddParam
 </b>
 ,
 <b>
  pmdaEventGetAddr
 </b>
 ,
 <b>
  pmdaEventNewHighResArray
 </b>
 ,
 <b>
  pmdaEventResetHighResArray
 </b>
 ,
 <b>
  pmdaEventReleaseHighResArray
 </b>
 ,
 <b>
  pmdaEventAddHighResRecord
 </b>
 ,
 <b>
  pmdaEventAddHighResMissedRecord
 </b>
 ,
 <b>
  pmdaEventHighResAddParam
 </b>
 ,
 <b>
  pmdaEventHighResGetAddr
 </b>
 - utilities for PMDAs to build packed arrays of event records
 <br/>
 <a name="lbAC">
 </a>
 <h2>
  C SYNOPSIS
 </h2>
 <b>
 </b>
 <pre>
#include &lt;<a href="https://github.com/performancecopilot/pcp/tree/master/src/include/pcp/pmapi.h">pcp/pmapi.h</a>&gt;
#include &lt;<a href="https://github.com/performancecopilot/pcp/tree/master/src/include/pcp/pmda.h">pcp/pmda.h</a>&gt;
</pre>
 <p>
  <br/>
  int pmdaEventNewArray(void);
  <br/>
  <br/>
  int pmdaEventResetArray(int
  <i>
   idx
  </i>
  );
  <br/>
  <br/>
  int pmdaEventReleaseArray(int
  <i>
   idx
  </i>
  );
  <br/>
  <br/>
  int pmdaEventAddRecord(int
  <i>
   idx
  </i>
  , struct timeval *
  <i>
   tp
  </i>
  , int
  <i>
   flags
  </i>
  );
  <br/>
  <br/>
  int pmdaEventAddMissedRecord(int
  <i>
   idx
  </i>
  , struct timeval *
  <i>
   tp
  </i>
  , int
  <i>
   nmissed
  </i>
  );
  <br/>
  <br/>
  int pmdaEventAddParam(int
  <i>
   idx
  </i>
  , pmID
  <i>
   pmid
  </i>
  , int
  <i>
   type
  </i>
  , pmAtomValue *
  <i>
   avp
  </i>
  );
  <br/>
  <br/>
  pmEventArray *pmdaEventGetAddr(int
  <i>
   idx
  </i>
  );
 </p>
 <p>
  <br/>
  int pmdaEventNewHighResArray(void);
  <br/>
  <br/>
  int pmdaEventResetHighResArray(int
  <i>
   idx
  </i>
  );
  <br/>
  <br/>
  int pmdaEventReleaseHighResArray(int
  <i>
   idx
  </i>
  );
  <br/>
  <br/>
  int pmdaEventAddHighResRecord(int
  <i>
   idx
  </i>
  , struct timespec *
  <i>
   ts
  </i>
  , int
  <i>
   flags
  </i>
  );
  <br/>
  <br/>
  int pmdaEventAddHighResMissedRecord(int
  <i>
   idx
  </i>
  , struct timespec *
  <i>
   ts
  </i>
  , int
  <i>
   nmissed
  </i>
  );
  <br/>
  <br/>
  int pmdaEventHighResAddParam(int
  <i>
   idx
  </i>
  , pmID
  <i>
   pmid
  </i>
  , int
  <i>
   type
  </i>
  , pmAtomValue *
  <i>
   avp
  </i>
  );
  <br/>
  <br/>
  pmHighResEventArray *pmdaEventHighResGetAddr(int
  <i>
   idx
  </i>
  );
 </p>
 <p>
  cc ... -lpcp
  <a name="lbAD">
  </a>
 </p>
 <h2>
  DESCRIPTION
 </h2>
 A Performance Metrics Domain Agent (PMDA) that wishes to export
event records (or trace records) is encouraged to use a metric of
either type
 <b>
  PM_TYPE_EVENT
 </b>
 or
 <b>
  PM_TYPE_HIGHRES_EVENT
 </b>
 to encode a group of event records into a single packed array.
 <p>
  The only difference between the two metric types is the resolution
of the timestamp associated with each - in high resolution form it
is nanosecond scale (see
  <b>
   <a href="http://man7.org/linux/man-pages/man2/clock_gettime.2.html">
    clock_gettime
   </a>
  </b>
  (2)),

otherwise it is microseconds (see
  <b>
   <a href="http://man7.org/linux/man-pages/man2/gettimeofday.2.html">
    gettimeofday
   </a>
  </b>
  (2)).

For simplicity, we will only refer to the lower resolution API and
data structures hereafter - however, the higher resolution variants
are all named similarly and are used in the same way.
 </p>
 <p>
  The packed array of event records format is defined in
  <i>
   &lt;
   <a href="https://github.com/performancecopilot/pcp/tree/master/src/include/pcp/pmapi.h">
    pcp/pmapi.h
   </a>
   &gt;
  </i>
  and consists of a
  <b>
   pmEventArray
  </b>
  structure containing a variable number of
  <b>
   pmEventRecord
  </b>
  structures, each of which contains a variable number of
  <b>
   pmEventParameter
  </b>
  structures, which in turn may contain a variable length value for
each parameter of each event record.
 </p>
 <p>
  The higher resolution equivalents are defined in the same location,
and the structures are named the same.
Note that the
  <b>
   pmEventParameter
  </b>
  structure has no timestamp associated with it, hence it this does not
have a high resolution counterpart.
 </p>
 <p>
  The routines described here are designed to assist the PMDA developer
in building a packed array of event records, and managing all of the
memory allocations required to hold each instance of an array of event
records in a contiguous buffer.  Normal use would be as part of PMDA's
  <b>
   pmdaFetchCallBack
  </b>
  method.
 </p>
 <p>
  <b>
   pmdaEventNewArray
  </b>
  is used to create a new event array.  The return value is a small integer that
is used as the
  <i>
   idx
  </i>
  parameter to the other routines to identify a specific event array.
If needed, a PMDA can create and use multiple event arrays.
 </p>
 <p>
  To start a new cycle and refill an event array from the beginning, call
  <b>
   pmdaEventResetArray
  </b>
  .
 </p>
 <p>
  If the PMDA has finished with an event array,
  <b>
   pmdaEventReleaseArray
  </b>
  may be used to release the underlying storage and ``close'' the event
array so that subsequent attempts to use
  <i>
   idx
  </i>
  will return
  <b>
   PM_ERR_NOCONTEXT
  </b>
  .
 </p>
 <p>
  To start a new event record, use
  <b>
   pmdaEventAddRecord
  </b>
  .

The timestamp for the event record is given via
  <i>
   tp
  </i>
  and the
  <i>
   flags
  </i>
  parameter may be used to set the control field that determines the
type of the event record -
  <i>
   flags
  </i>
  may be the bit-wise ``or'' of one or more of the
  <b>
   PM_EVENT_FLAG_*
  </b>
  values defined in
  <i>
   &lt;
   <a href="https://github.com/performancecopilot/pcp/tree/master/src/include/pcp/pmapi.h">
    pcp/pmapi.h
   </a>
   &gt;
  </i>
  (but note that
  <b>
   PM_EVENT_FLAG_MISSED
  </b>
  should not be used in this context).
 </p>
 <p>
  If event records have been missed, either because the PMDA cannot keep
up or because the PMAPI client cannot keep up, then
  <b>
   pmdaEventAddMissedRecord
  </b>
  may be used.
  <i>
   idx
  </i>
  and
  <i>
   tp
  </i>
  have the same meaning as for
  <b>
   pmdaEventAddRecord
  </b>
  and
  <i>
   nmissed
  </i>
  is the number of event records that have been missed at this point
in the time-series of event records.
  <b>
   pmdaEventAddMissedRecord
  </b>
  may be called multiple times for a single batch of event records
if there are more than one ``missed event record'' episode.
 </p>
 <p>
  Once an event record has been started by calling
  <b>
   pmdaEventAddRecord
  </b>
  ,

one or more event parameters may be added using
  <b>
   pmdaEventAddParam
  </b>
  .

The
  <i>
   pmid
  </i>
  and
  <i>
   type
  </i>
  parameters decribe the PMID of the parameter and the data type
(one of the
  <b>
   PM_TYPE_*
  </b>
  values from
  <i>
   &lt;
   <a href="https://github.com/performancecopilot/pcp/tree/master/src/include/pcp/pmapi.h">
    pcp/pmapi.h
   </a>
   &gt;
  </i>
  )

of the value that is passed via
  <i>
   avp
  </i>
  .
  <i>
   type
  </i>
  should one where the size of the value is implied by the
  <i>
   type
  </i>
  or by the length of a string value (for
  <b>
   PM_TYPE_STRING
  </b>
  )

or encoded within
  <i>
   avp-&gt;vbp
  </i>
  (for
  <b>
   PM_TYPE_AGGREGATE
  </b>
  ).
 </p>
 <p>
  Once the packed array has been constructed,
  <b>
   pmdaEventGetAddr
  </b>
  should be used to initialize the
  <b>
   ea_type
  </b>
  and
  <b>
   ea_len
  </b>
  fields at the start of the
  <b>
   pmEventArray
  </b>
  and return the base address of the event array
that is assigned to the
  <b>
   vp
  </b>
  field of the
  <b>
   pmAtomValue
  </b>
  structure that the
  <b>
   pmdaFetchCallBack
  </b>
  method should return.
  <a name="lbAE">
  </a>
 </p>
 <h2>
  EXAMPLE
 </h2>
 The following skeletal code shows how these routines might be used.
 <p>
  <font size="-1">
  </font>
 </p>
 <pre>
int             sts;
int             myarray;
int             first = 1;
pmEventArray    eap;

if (first) {
   first = 0;
   if ((myarray = pmdaEventNewArray()) &lt; 0) {
      // report error and fail
   }
}

pmdaEventResetArray(myarray);

// loop over all event records to be exported
... {
   struct timeval   stamp;
   int              flags;

   // establish timestamp and set flags to 0 or some combination
   // of PM_EVENT_FLAG_POINT, PM_EVENT_FLAG_START, PM_EVENT_FLAG_ID,
   // etc
   if ((sts = pmdaEventAddRecord(myarray, &amp;stamp, flags)) &lt; 0) {
      // report error and fail
   }

   // loop over all parameters for this event record
   ... {
      pmID          pmid;
      int           type;
      pmAtomValue   atom;
      
      // construct pmid, type and atom for the parameter and
      // its value
      if ((sts = pmdaEventAddParam(myarray, pmid, type, &amp;atom)) &lt; 0) {
         // report error and fail
      }
   }

   // if some event records were missed (could be at the start
   // of the exported set, or at the end, or in the middle, or
   // a combination of multiple missed record episodes)
   ... {
      int              nmiss;
      struct timeval   stamp;

      if ((sts = pmdaEventAddMissedRecord(myarray, &amp;stamp, nmiss)) &lt; 0) {
         // report error and fail
      }
   }
}

// finish up
eap = pmdaEventGetAddr(myarray);
</pre>
 <a name="lbAF">
 </a>
 <h2>
  SEE ALSO
 </h2>
 <b>
  <a href="http://man7.org/linux/man-pages/man2/clock_gettime.2.html">
   clock_gettime
  </a>
 </b>
 (2),
 <b>
  <a href="http://man7.org/linux/man-pages/man2/gettimeofday.2.html">
   gettimeofday
  </a>
 </b>
 (2),
 <b>
  <a href="/man/man3/pmdaeventnewqueue.3.html">
   pmdaEventNewQueue
  </a>
 </b>
 (3),
 <b>
  <a href="/man/man3/pmdaeventnewclient.3.html">
   pmdaEventNewClient
  </a>
 </b>
 (3),
 <b>
  <a href="/man/man3/pmda.3.html">
   PMDA
  </a>
 </b>
 (3)

and
 <b>
  <a href="/man/man3/pmeventflagsstr.3.html">
   pmEventFlagsStr
  </a>
 </b>
 (3).
 <p>
 </p>
 <hr/>
 <a name="index">
 </a>
 <h2>
  Index
 </h2>
 <dl>
  <dt>
   <a href="#lbAB">
    NAME
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAC">
    C SYNOPSIS
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAD">
    DESCRIPTION
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAE">
    EXAMPLE
   </a>
  </dt>
  <dd>
  </dd>
  <dt>
   <a href="#lbAF">
    SEE ALSO
   </a>
  </dt>
  <dd>
  </dd>
 </dl>
 
</div>
</div>
</div>
</div>
</div>
<footer class='global-footer is-typeset'>
<div class='row-parent'>
<div class='row'>
<section class='row__colspaced'>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>Main Menu</h4>
<ul>
<li>
<a href='/features.html'>Features</a>
</li>
<li>
<a href='/documentation.html'>Documentation</a>
</li>
<li>
<a class='download' href='/download.html'>Download</a>
</li>
</ul>
</div>
</div>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>Developers</h4>
<ul>
<li>
<a href='https://github.com/performancecopilot/pcp/issues'>Report an issue</a>
</li>
<li>
<a href='https://pcp.io/roadmap'>Roadmap</a>
</li>
<li>
<a href='/community.html'>Contributing</a>
</li>
<li>
<a href='/team.html'>Team</a>
</li>
</ul>
</div>
</div>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>About</h4>
<ul>
<li>
<a href='/testimonials.html'>Testimonials</a>
</li>
<li>
<a href='/faq.html'>FAQ</a>
</li>
<li>
<a href='/website.html'>Website</a>
</li>
</ul>
</div>
</div>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>Get Social</h4>
<ul>
<li>
<a class='twitter' href='https://twitter.com/performancepcp' rel='external'>Twitter</a>
</li>
<li>
<a class='github' href='https://github.com/performancecopilot' rel='external'>Github</a>
</li>
</ul>
</div>
</div>
</section>
</div>
<div class='row'>
<div class='colspan2-2'>
<p class='legal'>
This website is Copyright &copy; 2000-2004 Silicon Graphics Inc, 2007-2010 Aconex, 2012-2018 Red Hat
</p>
</div>
</div>
</div>
</footer>

</body>
</html>
