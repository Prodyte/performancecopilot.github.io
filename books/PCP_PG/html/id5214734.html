<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns:d="http://docbook.org/ns/docbook">4.4.4. Elapsed Time Measures</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.2" /><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content="PCP-pcp-programmers-guide-3-en-US-4.0-4" /><link rel="home" href="index.html" title="Performance Co-Pilot™ Programmer's Guide" /><link rel="up" href="id5213288nat.html" title="4.4. Memory Mapped Values API" /><link rel="prev" href="ch04s04s03.html" title="4.4.3. Updating Mapped Values" /><link rel="next" href="id5213106.html" title="4.5. Performance Instrumentation and Tracing" /></head><body><p id="title"><a class="left" href="https://fedorahosted.org/publican"><img alt="Product Site" src="Common_Content/images//image_left.png" /></a><a class="right" href="https://fedorahosted.org/publican"><img alt="Documentation Site" src="Common_Content/images//image_right.png" /></a></p><ul class="docnav top"><li class="previous"><a accesskey="p" href="ch04s04s03.html"><strong>Prev</strong></a></li><li class="home">pcp-programmers-guide</li><li class="next"><a accesskey="n" href="id5213106.html"><strong>Next</strong></a></li></ul><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id5214734">
      ⁠</a>4.4.4. Elapsed Time Measures</h3></div></div></div><div class="para">
					<a id="Z1033577635nat" class="indexterm"></a> <a id="Z1033577636nat" class="indexterm"></a>One problem with the instrumentation model embodied by the <code class="command">pcp_mmv</code> library is providing timing information for long-running operations. For instrumenting long-running operations, like uploading downloading a file, the overall operation may be broken into smaller, discrete units of work which can be easily instrumented in terms of operations and througput measures. In other cases, there are no divisible units for long-running operations (for example a black-box library call) and instrumenting these operations presents a challenge. Sometimes the best that can be done is adding the instrumentation point at the completion of the operation, and simply accept the "bursty" nature of this approach. In these problematic cases, the work completed in one sampling-interval may have begun several intervals before, from the point of view of the monitoring tool, which can lead to misleading results.
				</div><div class="para">
					One technique that is available to combat this is through use of the MMV_TYPE_ELAPSED metric type, which provides the concept of a "timed section" of code. This mechanism stores the start time of an operation along with the mapped metric value (an "elapsed time" counter), via the <code class="command">mmv_stats_interval_start</code> instrumentation function. Then, with help from the MMV PMDA which recognizes this type, the act of sampling the metric value causes an <span class="bold bold"><strong>interim</strong></span> timestamp to be taken (by the MMV PMDA, not the application) and <span class="bold bold"><strong>combined</strong></span> with the initial timestamp to form a more accurate reflection of time spent within the timed section, which effectively smooths out the bursty nature of the instrumentation.
				</div><div class="para">
					The completion of each timed section of code is marked by a call to <code class="command">mmv_stats_interval_end</code> which signifies to the MMV PMDA that the operation is not active, and no extra "in-progress" time should be applied to the exported value. At that time, the elapsed time for the entire operation is calculated and accounted toward metrics value.
				</div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="ch04s04s03.html"><strong>Prev</strong>4.4.3. Updating Mapped Values</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="id5213106.html"><strong>Next</strong>4.5. Performance Instrumentation and Tracing</a></li></ul></body></html>