<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/TR/xhtml1/transitional" xmlns:fo="http://www.w3.org/1999/XSL/Format"><head xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns:d="http://docbook.org/ns/docbook">3.6.2. Event Collector Considerations</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.2" /><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content="PCP-pcp-programmers-guide-3-en-US-4.0-4" /><link rel="home" href="index.html" title="Performance Co-Pilot™ Programmer's Guide" /><link rel="up" href="id5199202.html" title="3.6. Performance Event Metrics" /><link rel="prev" href="id5199202.html" title="3.6. Performance Event Metrics" /><link rel="next" href="id5199203.html" title="3.7. PMAPI Programming Style and Interaction" />
<meta xmlns="" charset="utf-8" />
<meta xmlns="" content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
<meta xmlns="" content="initial-scale=1" name="viewport" />
<title xmlns="">Performance Co-Pilot</title>
<link xmlns="" href="/assets/css/screen.css" media="all" rel="stylesheet" type="text/css" />
<link xmlns="" href="/assets/css/master.css" media="all" rel="stylesheet" type="text/css" />
<link xmlns="" href="/images/pcp.ico" rel="shortcut icon" type="image/ico" />
</head><body>
    <header xmlns="" class="global-header">
      <div class="row">
        <h1 class="global-logo colspan12-6 colspan8-4 colspan6-3 colspan2-1 as-grid">
          <a href="/index.html">Performance Co-Pilot</a>
        </h1>
        <nav class="global-header__navigation colspan12-6 colspan8-6 colspan6-4 colspan2-1 as-grid">
          <ul>
            <li>
              <a href="/features.html">Features</a>
            </li>
            <li>
              <a href="/documentation.html">Documentation</a>
            </li>
            <li>
              <a href="/download.html">Download</a>
            </li>
            <li>
              <a href="/community.html">Get Involved</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>
<div class="site-content"><div class="how-to is-typeset"><div class="row-parent"><div class="row"><p xmlns="http://www.w3.org/1999/xhtml" id="title"><a class="left" href="https://pcp.io"><img alt="Product Site" src="Common_Content/images//image_left.png" /></a><a class="right" href="https://pcp.io/documentation.html"><img alt="Documentation Site" src="Common_Content/images//image_right.png" /></a></p><ul xmlns="http://www.w3.org/1999/xhtml" class="docnav top"><li class="previous"><a accesskey="p" href="id5199202.html"><strong>Prev</strong></a></li><li class="home">pcp-programmers-guide</li><li class="next"><a accesskey="n" href="id5199203.html"><strong>Next</strong></a></li></ul><div xmlns="http://www.w3.org/1999/xhtml" class="section"><div class="titlepage"><div><div keep-together.within-column="always"><h3 class="title"><a id="id5199204nat">
      ⁠</a>3.6.2. Event Collector Considerations</h3></div></div></div><div class="para">
					There is a feedback mechanism that is inherent in the design of the PCP monitor-collector event metric value exchange, which protects both monitor and collector components from becoming overrun by high frequency event arrivals. It is important that PMDA developers are aware of this mechanism and all of its implications.
				</div><div class="para">
					Monitor tools can query new event arrival on whatever schedule they choose. There are no guarantees that this is a fixed interval, and no way for the PMDA to attempt to dictate this interval (nor should there be).
				</div><div class="para">
					As a result, a PMDA that provides event metrics must:
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							Track individual client connections using the per-client PMDA extensions (PMDA_INTERFACE_5 or later).
						</div></li><li class="listitem"><div class="para">
							Queue events, preferably in a memory-efficient manner, such that each interested monitor tool (there may be more than one) is informed of those events that arrived since their last request.
						</div></li><li class="listitem"><div class="para">
							Control the memory allocated to in-memory event storage. If monitors are requesting new events too slowly, compared to event arrival on the collector, the "missed events" feedback mechanism must be used to inform the monitor. This mechanism is also part of the model by which a PMDA can fix the amount of memory it uses. Once a fixed space is consumed, events can be dropped from the tail of the queue for each client, provided a counter is incremented and the client is subsequently informed.
						</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						It is important that PMDAs are part of the performance solution, and not part of the performance problem! With event metrics, this is much more difficult to achieve than with counters or other sampled values.
					</div></div></div><div class="para">
					There is certainly elegance to this approach for event metrics, and the way they dovetail with other, sampled performance metrics is unique to PCP. Notice also how the scheme naturally allows multiple monitor tools to consume the same events, no matter what the source of events is. The downside to this flexibility is increased complexity in the PMDA when event metrics are used.
				</div><div class="para">
					This complexity comes in the form of event queueing and memory management, as well as per-client state tracking. Routines are available as part of the <code class="command">pcp_pmda</code> library to assist, however - refer to the man page entries for <code class="command">pmdaEventNewQueue(3)</code> and <code class="command">pmdaEventNewClient(3)</code> for further details.
				</div><div class="para">
					One final set of helper APIs is available to PMDA developers who incorporate event metrics. There is a need to build the <code class="command">pmEventArray</code> structure, introduced in <a class="xref" href="id5199202.html#Z976557818nat">Example 3.10, “ <code class="command">pmEventArray</code> and <code class="command">pmEventRecord</code> Structures”</a>. This can be done directly, or using the helper routine <code class="command">pmdaEventNewArray(3)</code>. If the latter, simpler model is chosen, the closely related routines <code class="command">pmdaEventAddRecord</code>, <code class="command">pmdaEventAddParam</code> and <code class="command">pmdaEventAddMissedRecord</code> would also usually be used.
				</div><div class="para">
					Depending on the nature of the events being exported by a PMDA, it can be desirable to perform <span class="bold bold"><strong>filtering</strong></span> of events on the collector system. This reduces the amount of event traffic between monitor and collector systems (which may be filtered further on the monitor system, before presenting results). Some PMDAs have had success using the <code class="command">pmStore(3)</code> mechanism to allow monitor tools to send a filter to the PMDA - using either a special control metric for the store operation, or the event metric itself. The filter sent will depend on the event metric, but it might be a regular expression, or a tracing script, or something else.
				</div><div class="para">
					This technique has also been used to <span class="bold bold"><strong>enable</strong></span> and <span class="bold bold"><strong>disable</strong></span> event tracing entirely. It is often appropriate to make use of authentication and user credentials when providing such a facility (PMDA_INTERFACE_6 or later).
				</div></div><ul xmlns="http://www.w3.org/1999/xhtml" class="docnav"><li class="previous"><a accesskey="p" href="id5199202.html"><strong>Prev</strong>3.6. Performance Event Metrics</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="id5199203.html"><strong>Next</strong>3.7. PMAPI Programming Style and Interaction</a></li></ul></div></div></div></div>
<footer xmlns="" class="global-footer is-typeset">
  <div class="row-parent">
    <div class="row">
      <section class="row__colspaced"><div class="colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter">
          <div class="col__module">
            <h4>Main Menu</h4>
            <ul>
              <li>
                <a href="/features.html">Features</a>
              </li>
              <li>
                <a href="/documentation.html">Documentation</a>
              </li>
              <li>
                <a class="download" href="/download.html">Download</a>
              </li>
            </ul>
          </div>
        </div><div class="colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter">
          <div class="col__module">
            <h4>Developers</h4>
            <ul>
              <li>
                <a href="http://git.pcp.io/bugzilla">Report a bug</a>
              </li>
              <li>
                <a href="/community.html">Contributing</a>
              </li>
              <li>
                <a href="/team.html">Team</a>
              </li>
            </ul>
          </div>
        </div><div class="colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter">
          <div class="col__module">
            <h4>About</h4>
            <ul>
              <li>
                <a href="/news.html">News</a>
              </li>
              <li>
                <a href="/testimonials.html">Testimonials</a>
              </li>
              <li>
                <a href="/faq.html">FAQ</a>
              </li>
              <li>
                <a href="/website.html">Website</a>
              </li>
            </ul>
          </div>
        </div><div class="colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter">
          <div class="col__module">
            <h4>Get Social</h4>
            <ul>
              <li>
                <a class="twitter" href="https://twitter.com/performancepcp" rel="external">Twitter</a>
              </li>
              <li>
                <a class="github" href="https://github.com/performancecopilot" rel="external">Github</a>
              </li>
            </ul>
          </div>
        </div></section>
    </div>
    <div class="row">
      <div class="colspan2-2">
        <p class="legal">
          Copyright 2000-2004 Silicon Graphics Inc, 2007-2010 Aconex, 2012-2015 Red Hat
        </p>
      </div>
    </div>
  </div>
</footer>
</body></html>